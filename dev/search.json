[{"path":"https://pedreirajr.github.io/cnefetools/dev/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2025 Jorge Ubirajara Pedreira Junior Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"attaching-libraries","dir":"Articles","previous_headings":"","what":"Attaching libraries:","title":"Aggregating CNEFE address counts","text":"","code":"library(cnefetools) library(geobr) library(dplyr) library(sf) library(mapview)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"reading-cnefe-data-to-visualize-educational-and-religious-establishments","dir":"Articles","previous_headings":"","what":"Reading CNEFE data to visualize educational and religious establishments:","title":"Aggregating CNEFE address counts","text":"","code":"poa_cnefe <- read_cnefe(   code_muni = 4314902, # IBGE code for Porto Alegre)   cache = T,   output = 'sf',   verbose = F   )  poa_cnefe_edurel <- poa_cnefe |>    filter(COD_ESPECIE %in% c(4,8)) |> # Select only educational (4) and religious (8) facilities   mutate(     est_type = factor(ifelse(COD_ESPECIE == 4,'Educational','Religious'))          )  mapview(   poa_cnefe_edurel,    zcol = 'est_type',    layer.name = 'Establishment type',   col.regions = c(\"blue\",\"red\"), # Blue (educational) and Red (religious)   cex = 2,   burst = T )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"the-index-of-concentration-at-the-extremes-ice","dir":"Articles","previous_headings":"","what":"The Index of Concentration at the Extremes (ICE)","title":"Aggregating CNEFE address counts","text":"ICE originally proposed Booth & Crouter (2001) measure spatial concentration two groups. adapt compare educational (addr_type4) religious (addr_type8) establishments: ICE=neducational−nreligiousneducational+nreligious \\text{ICE} = \\frac{n_{\\text{educational}} - n_{\\text{religious}}}{n_{\\text{educational}} + n_{\\text{religious}}} index ranges -1 +1: +1: establishments educational (maximum concentration educational establishments) 0: equal number educational religious establishments -1: establishments religious (maximum concentration temples)","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"aggregating-counts-to-h3-hexagons","dir":"Articles","previous_headings":"","what":"Aggregating counts to H3 hexagons","title":"Aggregating CNEFE address counts","text":"use cnefe_counts() polygon_type = \"hex\" h3_resolution = 8 aggregate address counts H3 hexagonal cells. Resolution 8 cells average area approximately 0.74 km². output contains columns addr_type1 addr_type8, corresponding CNEFE address types. ones interested : addr_type4: Educational establishments addr_type8: Religious establishments","code":"poa_hex_counts <- cnefe_counts(   code_muni = 4314902, # IBGE code for Porto Alegre   polygon_type = \"hex\",   h3_resolution = 8 ) #> ℹ Step 1/3: Ensuring ZIP and inspecting archive... #> ℹ Using cached file: C:\\Users\\jorge\\AppData\\Local/R/cache/R/cnefetools/4314902_PORTO_ALEGRE.zip #> ℹ Step 1/3: Ensuring ZIP and inspecting archive... ✔ Step 1/3 (CNEFE ZIP ready) [157ms] #>  #> ℹ Step 2/3: Building full H3 grid over municipality boundary... #> ✔ Step 2/3 (H3 grid built) [3.9s] #>  #> ℹ Step 3/3: Counting address species per hexagon... #> ✔ Step 3/3 (Addresses counted) [1.5s]  head(poa_hex_counts) #> Simple feature collection with 6 features and 9 fields #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: -51.1276 ymin: -30.24817 xmax: -51.08759 ymax: -30.22164 #> Geodetic CRS:  WGS 84 #>            id_hex addr_type1 addr_type2 addr_type3 addr_type4 addr_type5 #> 1 88a9010c83fffff          0          0          0          0          0 #> 2 88a9010c87fffff        444          0          0          0          1 #> 3 88a9010c8bfffff          0          0          0          0          0 #> 4 88a9010c91fffff          5          0          0          0          0 #> 5 88a9010c93fffff         11          0          0          0          0 #> 6 88a9010c95fffff         43          0          0          0          0 #>   addr_type6 addr_type7 addr_type8                       geometry #> 1          0          0          0 POLYGON ((-51.10091 -30.241... #> 2         27          6          5 POLYGON ((-51.09175 -30.240... #> 3          0          0          0 POLYGON ((-51.10422 -30.248... #> 4          2          0          0 POLYGON ((-51.11591 -30.236... #> 5          1          0          0 POLYGON ((-51.12176 -30.230... #> 6          2          0          0 POLYGON ((-51.10675 -30.235..."},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"computing-ice-for-h3-hexagons","dir":"Articles","previous_headings":"","what":"Computing ICE for H3 hexagons","title":"Aggregating CNEFE address counts","text":"compute ICE hexagons least one educational religious establishment:","code":"poa_hex_ice <- poa_hex_counts |>   filter(addr_type4 > 0 | addr_type8 > 0) |>   mutate(     ice = (addr_type4 - addr_type8) / (addr_type4 + addr_type8)   )  summary(poa_hex_ice$ice) #>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.  #> -1.00000 -1.00000 -0.38462 -0.27384  0.07692  1.00000"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"mapping-h3-results","dir":"Articles","previous_headings":"","what":"Mapping H3 results","title":"Aggregating CNEFE address counts","text":"use diverging color scale: blue indicates higher concentration educational establishments (+1), white indicates balance (0), red indicates higher concentration religious establishments (-1).","code":"mapview(   poa_hex_ice,   zcol = \"ice\",   col.regions = colorRampPalette(c(\"red\", \"white\", \"blue\")),   layer.name = \"ICE (H3 res. 8)\" )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"aggregating-counts-to-neighborhoods","dir":"Articles","previous_headings":"","what":"Aggregating counts to neighborhoods","title":"Aggregating CNEFE address counts","text":"Now use official neighborhood boundaries geobr package. cnefe_counts() function accepts user-provided polygons via polygon argument.","code":"# Load Porto Alegre neighborhoods poa_neighborhoods <- read_neighborhood(year = 2022, simplified = FALSE) |>   filter(name_muni == \"Porto Alegre\")  nrow(poa_neighborhoods) #> [1] 94 poa_neigh_counts <- cnefe_counts(   code_muni = 4314902,   polygon_type = \"user\",   polygon = poa_neighborhoods ) #> ℹ Step 1/2: Ensuring data and preparing polygon... #> ℹ Using cached file: C:\\Users\\jorge\\AppData\\Local/R/cache/R/cnefetools/4314902_PORTO_ALEGRE.zip #> ℹ Step 1/2: Ensuring data and preparing polygon... ✔ Step 1/2 (Data and polygon ready) [407ms] #>  #> ℹ Step 2/2: Counting addresses per polygon... #> Warning: Polygon coverage: \"100.0%\" of CNEFE points captured. #> ℹ 762110 of 762239 points are within the provided polygon. #> ℹ 129 points fell outside the polygon and were not counted. #> ✔ Step 2/2 (Addresses counted) [3s]  head(poa_neigh_counts) #> Simple feature collection with 6 features and 26 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -51.30325 ymin: -30.17167 xmax: -51.10924 ymax: -29.9323 #> Geodetic CRS:  SIRGAS 2000 #>   code_muni    name_muni name_neighborhood code_neighborhood code_subdistrict #> 1   4314902 Porto Alegre Aberta dos Morros        4314902080      43149020500 #> 2   4314902 Porto Alegre         Agronomia        4314902035      43149020500 #> 3   4314902 Porto Alegre          Anchieta        4314902055      43149020500 #> 4   4314902 Porto Alegre       Arquipélago        4314902033      43149020500 #> 5   4314902 Porto Alegre       Auxiliadora        4314902045      43149020500 #> 6   4314902 Porto Alegre            Azenha        4314902008      43149020500 #>   name_subdistrict code_district name_district code_urban_concentration #> 1             <NA>     431490205  Porto Alegre                  4314902 #> 2             <NA>     431490205  Porto Alegre                  4314902 #> 3             <NA>     431490205  Porto Alegre                  4314902 #> 4             <NA>     431490205  Porto Alegre                  4314902 #> 5             <NA>     431490205  Porto Alegre                  4314902 #> 6             <NA>     431490205  Porto Alegre                  4314902 #>   name_urban_concentration code_immediate name_immediate code_intermediate #> 1          Porto Alegre/RS         430001   Porto Alegre              4301 #> 2          Porto Alegre/RS         430001   Porto Alegre              4301 #> 3          Porto Alegre/RS         430001   Porto Alegre              4301 #> 4          Porto Alegre/RS         430001   Porto Alegre              4301 #> 5          Porto Alegre/RS         430001   Porto Alegre              4301 #> 6          Porto Alegre/RS         430001   Porto Alegre              4301 #>   name_intermediate code_state        name_state code_region name_region #> 1      Porto Alegre         43 Rio Grande do Sul           4         Sul #> 2      Porto Alegre         43 Rio Grande do Sul           4         Sul #> 3      Porto Alegre         43 Rio Grande do Sul           4         Sul #> 4      Porto Alegre         43 Rio Grande do Sul           4         Sul #> 5      Porto Alegre         43 Rio Grande do Sul           4         Sul #> 6      Porto Alegre         43 Rio Grande do Sul           4         Sul #>   addr_type1 addr_type2 addr_type3 addr_type4 addr_type5 addr_type6 addr_type7 #> 1       4249          1          1          8          2        235        147 #> 2       1219          3          1         11          1        113         22 #> 3        294          1          0          3          1        446         16 #> 4       2851          1          1         12          2        286         62 #> 5       5464          3          0          9         45        576         57 #> 6       8150         10          0         17         31       1236         39 #>   addr_type8                           geom #> 1         15 MULTIPOLYGON (((-51.20221 -... #> 2          5 MULTIPOLYGON (((-51.15367 -... #> 3          1 MULTIPOLYGON (((-51.15517 -... #> 4         28 MULTIPOLYGON (((-51.26181 -... #> 5          1 MULTIPOLYGON (((-51.1865 -3... #> 6          5 MULTIPOLYGON (((-51.21153 -..."},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"computing-ice-by-neighborhood","dir":"Articles","previous_headings":"","what":"Computing ICE by neighborhood","title":"Aggregating CNEFE address counts","text":"","code":"poa_neigh_ice <- poa_neigh_counts |>   filter(addr_type4 > 0 | addr_type8 > 0) |>   mutate(     ice = (addr_type4 - addr_type8) / (addr_type4 + addr_type8)   )  summary(poa_neigh_ice$ice) #>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.  #> -1.00000 -0.44444 -0.20000 -0.07657  0.40741  1.00000"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"mapping-neighborhood-results","dir":"Articles","previous_headings":"","what":"Mapping neighborhood results","title":"Aggregating CNEFE address counts","text":"","code":"mapview(   poa_neigh_ice,   zcol = \"ice\",   col.regions = colorRampPalette(c(\"red\", \"white\", \"blue\")),   layer.name = \"ICE (Neighborhoods)\" )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"comparing-spatial-resolutions","dir":"Articles","previous_headings":"","what":"Comparing spatial resolutions","title":"Aggregating CNEFE address counts","text":"H3 hexagonal grid offers several desirable topological properties spatial analysis: cells area shape, every cell exactly six neighbors equal distances, grid avoids orientation artifacts arise square grids. properties make hexagonal grids particularly well-suited spatial statistics, neighborhood-based indicators, smooth interpolation across space. hand, user-provided polygons, neighborhoods health districts, carry administrative institutional meaning directly relevant policy-making domain-specific research. supporting polygon geometry, cnefe_counts() allows researchers practitioners aggregate CNEFE data whichever spatial unit best fits study design. approaches demonstrate cnefe_counts() enables intra-urban analysis, moving beyond aggregate national statistics reveal spatial patterns within cities.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/cnefe_counts.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Aggregating CNEFE address counts","text":"Booth, .; Crouter, . C. (Eds.). (2001). Take Village? Community Effects Children, Adolescents, Families. Psychology Press.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"a-brief-overview-of-the-indices","dir":"Articles","previous_headings":"","what":"A brief overview of the indices","title":"Computing land-use mix indices with CNEFE data","text":"three indices computed local residential share within spatial unit ii, pi=nres,/ntot,ip_{} = n_{\\text{res},} / n_{\\text{tot},}, nres,in_{\\text{res},} number residential addresses ntot,in_{\\text{tot},} total number addresses (excluding construction) spatial unit {}. local non-residential share qi=1−piq_{} = 1 - p_{}, citywide residential share denoted PP.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"entropy-index-ei","dir":"Articles","previous_headings":"A brief overview of the indices","what":"Entropy Index (EI)","title":"Computing land-use mix indices with CNEFE data","text":"EIi=−pilnpi+qilnqiln2 \\text{EI}_{} = -\\frac{p_{} \\ln p_{} + q_{} \\ln q_{}}{\\ln 2} EI ranges 0 (complete homogeneity) 1 (perfect 50/50 balance). measures mixed unit , indicate use dominates unit homogeneous: fully residential cell fully non-residential cell receive EI = 0.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"balance-index-bal","dir":"Articles","previous_headings":"A brief overview of the indices","what":"Balance Index (BAL)","title":"Computing land-use mix indices with CNEFE data","text":"BALi=1−|pi−P1−P⋅qi|pi+P1−P⋅qi \\text{BAL}_{} = 1 - \\frac{\\left| p_{} - \\frac{P}{1-P} \\cdot q_{} \\right|}{p_{} + \\frac{P}{1-P} \\cdot q_{}} BAL also ranges 0 1, defines balance relative observed citywide composition rather fixed 50/50 split. means BAL = 1 pi=Pp_{} = P, necessarily pi=0.5p_{} = 0.5. Like EI, however, BAL non-directional: indicate whether low-balance cell predominantly residential non-residential.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"bidirectional-global-centered-balance-index-bgbi","dir":"Articles","previous_headings":"A brief overview of the indices","what":"Bidirectional Global-centered Balance Index (BGBI)","title":"Computing land-use mix indices with CNEFE data","text":"BGBIi=(2pi−1)−(2P−1)1−(2pi−1)(2P−1) \\text{BGBI}_{} = \\frac{(2p_{} - 1) - (2P - 1)}{1 - (2p_{} - 1)(2P - 1)} BGBI ranges -1 +1 addresses two limitations conventional indices: Directionality: positive values indicate local residential share citywide reference (pi>Pp_{} > P), negative values indicate non-residential dominance (pi<Pp_{} < P). allows analysts distinguish functionally opposite patterns without consulting auxiliary data. Citywide reference: BGBI centered pi=Pp_{} = P (BGBI = 0) rather pi=0.5p_{} = 0.5. citywide composition highly asymmetric (e.g., P≈0.9P \\approx 0.9), treating 50/50 universal balance target can distort interpretation. BGBI instead evaluates local composition empirically observed baseline.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Computing land-use mix indices with CNEFE data","text":"","code":"library(cnefetools) library(dplyr) library(tidyr) library(ggplot2) library(sf) library(mapview) library(leafsync)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"visualizing-the-index-domains","dir":"Articles","previous_headings":"","what":"Visualizing the index domains","title":"Computing land-use mix indices with CNEFE data","text":"generating indices real data, let’s examine EI, BAL, BGBI behave function pip_{} stylized city P=0.75P = 0.75, typical Brazilian municipalities.  Notice EI peaks pi=0.5p_{} = 0.5 (50/50 split) symmetric around point, whereas BAL peaks pi=P=0.75p_{} = P = 0.75 (citywide reference), reflecting global centering. non-negative non-directional. BGBI, contrast, crosses zero pi=Pp_{} = P spans full [−1,+1][-1, +1] range, providing signed measure distinguishes residential-dominant non-residential-dominant cells.","code":"P <- 0.75 # citywide residential proportion  ## BGBI function: bgbi_fun <- function(p, P) {   ((2 * p - 1) - (2 * P - 1)) / (1 - (2 * p - 1) * (2 * P - 1)) }  ## EI function: ei_fun <- function(p) {   q <- 1 - p   m <- cbind(p, q)   m[m == 0] <- NA # avoid log(0)   -rowSums(m * log(m), na.rm = TRUE) / log(2) }  ## BAL function: bal_fun <- function(p, P) {   1 - abs(p - (P / (1 - P)) * (1 - p)) /     (p + (P / (1 - P)) * (1 - p)) }  ## Generating p values between 0 and 1 p <- seq(0, 1, by = 0.01)  ## Index dataframe df_ind <- data.frame(p = p) |>   mutate(     EI = ei_fun(p),     BAL = bal_fun(p, P),     BGBI = bgbi_fun(p, P)   ) |>   pivot_longer(     cols = c(EI, BAL, BGBI),     names_to = \"Index\",     values_to = \"Value\"   ) |>   mutate(Index = factor(Index, levels = c(\"EI\", \"BAL\", \"BGBI\")))  ## Plotting ggplot(df_ind, aes(x = p, y = Value, color = Index)) +   geom_line(linewidth = 0.8) +   geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +   geom_vline(xintercept = P, linetype = \"dotted\", color = \"gray50\") +   annotate(\"text\", x = P + 0.02, y = -0.8, label = paste0(\"P = \", P),            hjust = 0, size = 3.5, color = \"gray30\") +   scale_x_continuous(     expression(p[i]),     breaks = seq(0, 1, by = 0.2)   ) +   labs(y = \"Index value\", color = NULL) +   theme_minimal() +   theme(legend.position = \"bottom\")"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"computing-the-indices-with-compute_lumi-for-são-paulo-h3-resolution-8","dir":"Articles","previous_headings":"","what":"Computing the indices with compute_lumi for São Paulo (H3 resolution 8)","title":"Computing land-use mix indices with CNEFE data","text":"output includes, among others, columns ei, bal, bgbi.","code":"spo_lumi <- compute_lumi(   code_muni = 3550308, # IBGE code for São Paulo   h3_resolution = 8 ) #> ℹ Processing municipality code 3550308... #> ℹ Step 1/3: Ensuring ZIP and inspecting archive... #> ℹ Using cached file: C:\\Users\\jorge\\AppData\\Local/R/cache/R/cnefetools/3550308_SAO_PAULO.zip #> ℹ Step 1/3: Ensuring ZIP and inspecting archive... ✔ Step 1/3 (CNEFE ZIP ready) [147ms] #>  #> ℹ Step 2/3: Counting addresses per H3 cell... #> ✔ Step 2/3 (Addresses counted) [8.3s] #>  #> ℹ Step 3/3: Building grid and computing LUMI... #> ✔ Step 3/3 (Land use mix indices computed) [391ms]  head(spo_lumi) #> Simple feature collection with 6 features and 8 fields #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: -46.64775 ymin: -23.72164 xmax: -46.61922 ymax: -23.69734 #> Geodetic CRS:  WGS 84 #>            id_hex     p_res        ei       hhi       bal       ice   hhi_adp #> 1 88a8100001fffff 0.9277630 0.3742168 0.8659623 0.7773072 0.8555260 0.7319247 #> 2 88a8100003fffff 0.8941588 0.4872430 0.8107223 0.9829543 0.7883175 0.6214445 #> 3 88a8100005fffff 0.9271726 0.3763875 0.8649528 0.7814819 0.8543452 0.7299057 #> 4 88a8100007fffff 0.9072356 0.4456303 0.8316817 0.9099987 0.8144712 0.6633634 #> 5 88a8100009fffff 0.9493506 0.2891490 0.9038320 0.6068659 0.8987013 0.8076640 #> 6 88a810000bfffff 0.8867624 0.5096051 0.7991702 0.9791230 0.7735247 0.5983405 #>          bgbi                       geometry #> 1  0.22269279 POLYGON ((-46.6326 -23.7141... #> 2  0.01704570 POLYGON ((-46.63854 -23.707... #> 3  0.21851813 POLYGON ((-46.62338 -23.713... #> 4  0.09000133 POLYGON ((-46.62932 -23.706... #> 5  0.39313410 POLYGON ((-46.63588 -23.721... #> 6 -0.02087697 POLYGON ((-46.64182 -23.715..."},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"mapping-ei-bal-and-bgbi-side-by-side","dir":"Articles","previous_headings":"","what":"Mapping EI, BAL, and BGBI side by side","title":"Computing land-use mix indices with CNEFE data","text":"use leafsync::sync() display three maps single row. EI BAL use default mapview palette, BGBI uses diverging red-white-blue scale red indicates non-residential dominance (-1), white indicates citywide-referenced balance (0), blue indicates residential dominance (+1).","code":"map_ei <- mapview(   spo_lumi,   zcol = \"ei\",   layer.name = \"EI\" )  map_bal <- mapview(   spo_lumi,   zcol = \"bal\",   layer.name = \"BAL\" )  map_bgbi <- mapview(   spo_lumi,   zcol = \"bgbi\",   col.regions = colorRampPalette(c(\"red\", \"white\", \"blue\")),   layer.name = \"BGBI\" )  sync(map_ei, map_bal, map_bgbi, ncol = 3)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"interpreting-the-maps","dir":"Articles","previous_headings":"","what":"Interpreting the maps","title":"Computing land-use mix indices with CNEFE data","text":"EI BAL highlight mixed hexagon , distinguish hexagons dominated residential addresses dominated non-residential addresses. BGBI resolves ambiguity encoding direction deviation citywide baseline sign. yields three-part spatial interpretation: BGBI near 0 (white): local composition close citywide reference (balanced transition zones). BGBI > 0 (blue): local residential share exceeds citywide reference. BGBI < 0 (red): non-residential uses dominate relative citywide reference. directional information especially useful citywide composition highly asymmetric (typical Brazilian cities, P≈0.9P \\approx 0.9), conventional indices compress cells narrow range indicate direction homogeneity.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"producing-indices-for-any-user-supplied-polygon","dir":"Articles","previous_headings":"","what":"Producing indices for any user-supplied polygon","title":"Computing land-use mix indices with CNEFE data","text":"compute_lumi() also supports user-provided polygons via polygon_type = \"user\" argument, enabling computation indices spatial unit interest (neighborhoods, census tracts, health districts), depending specific research policy purpose. See example neighborhoods Maringá (IBGE code 4115200), downloaded geobr package.","code":"library(geobr)  mga_nei <- read_neighborhood(year = 2022) |>   filter(code_muni == 4115200) # IBGE code for Maringá  mga_lumi <- compute_lumi(   code_muni = 4115200,   polygon_type = \"user\",   polygon = mga_nei )  mapview(   mga_lumi,   zcol = \"bgbi\",   col.regions = colorRampPalette(c(\"red\", \"white\", \"blue\")),   layer.name = \"BGBI\" )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"notes-on-user-supplied-polygons","dir":"Articles","previous_headings":"Producing indices for any user-supplied polygon","what":"Notes on user-supplied polygons","title":"Computing land-use mix indices with CNEFE data","text":"polygon provided polygon_type explicitly set \"user\", function automatically switches polygon_type = \"user\" issues warning beginning processing. CRS output layer matches CRS layer supplied polygon. different CRS desired, can specified via crs_output argument.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"notes","dir":"Articles","previous_headings":"","what":"Notes","title":"Computing land-use mix indices with CNEFE data","text":"addition EI, BAL, BGBI, compute_lumi() also produces Index Concentration Extremes (ICE), Herfindahl–Hirschman Index (HHI), adapted HHI (aHHI), converts HHI directional index (Pedreira Jr. et al., 2025). indices returned single output, allowing comprehensive comparisons within workflow.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/compute_lumi.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Computing land-use mix indices with CNEFE data","text":"Pedreira Jr., J. U.; Louro, T. V.; Assis, L. B. M.; Brito, P. L. (2025). Measuring land use mix address-level census data. engrXiv. https://engrxiv.org/preprint/view/5975","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/faq.html","id":"what-is-h3-and-how-does-resolution-work","dir":"Articles","previous_headings":"","what":"What is H3 and how does resolution work?","title":"FAQ","text":"H3 geospatial indexing system developed Uber divides world hexagonal cells. Unlike traditional grids (squares), hexagons provide uniform distances neighboring cells better represent spatial relationships. resolution parameter controls hexagon size across 16 levels (0-15). Lower resolutions create larger hexagons suitable regional analysis, higher resolutions create smaller hexagons reveal neighborhood-level detail. resolution level reduces hexagon area approximately 7×. Learn h3geo.org.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/faq.html","id":"visual-comparison-são-paulo-at-different-resolutions","dir":"Articles","previous_headings":"What is H3 and how does resolution work?","what":"Visual comparison: São Paulo at different resolutions","title":"FAQ","text":"show municipality (São Paulo - SP) resolutions 1 9. Notice finer resolutions reveal spatial patterns smoothed coarser scales. base function used example:","code":"library(cnefetools)  tracts_to_h3(     code_muni = 3550308,  # São Paulo     h3_resolution = res   # 1 to 9   )"},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"downloading-cnefe-data","dir":"Articles","previous_headings":"","what":"Downloading CNEFE data","title":"Reading and exploring CNEFE data","text":"can download CNEFE data Brazilian municipality just single line code. setting output = \"sf\", result returned spatial sf object, ready mapping spatial analysis. avoid downloading file sections, can cache municipality interest setting cache parameter TRUE. careful, however, plotting full dataset, since large municipalities may contain millions points (Salvador 1.3 million records).","code":"library(cnefetools) library(dplyr) library(sf)  # Download CNEFE for Salvador (IBGE code 2927408) as an sf object ssa_cnefe <- read_cnefe(code_muni = 2927408, cache = TRUE, output = \"sf\")"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"exploring-available-columns","dir":"Articles","previous_headings":"","what":"Exploring available columns","title":"Reading and exploring CNEFE data","text":"Key columns example: COD_ESPECIE — address type (1 = private household, 2 = collective household, 3 = agricultural, 4 = educational, 5 = health, 6 = , 7 = construction, 8 = religious). DSC_ESTABELECIMENTO — free-text name/description establishment (filled non-residential addresses). geometry — point geometry geographic coordinates. spreadsheet data dictionary (Portuguese) can accessed function cnefe_dictionary(), open system’s default spreadsheet viewer. understand whole methodology CNEFE collection, also consult PDF methodological document (also Portuguese) cnefe_doc() function. Currently, CNEFE 2022 Census available package.","code":"names(ssa_cnefe) #>  [1] \"COD_UNICO_ENDERECO\"             \"COD_UF\"                         #>  [3] \"COD_MUNICIPIO\"                  \"COD_DISTRITO\"                   #>  [5] \"COD_SUBDISTRITO\"                \"COD_SETOR\"                      #>  [7] \"NUM_QUADRA\"                     \"NUM_FACE\"                       #>  [9] \"CEP\"                            \"DSC_LOCALIDADE\"                 #> [11] \"NOM_TIPO_SEGLOGR\"               \"NOM_TITULO_SEGLOGR\"             #> [13] \"NOM_SEGLOGR\"                    \"NUM_ENDERECO\"                   #> [15] \"DSC_MODIFICADOR\"                \"NOM_COMP_ELEM1\"                 #> [17] \"VAL_COMP_ELEM1\"                 \"NOM_COMP_ELEM2\"                 #> [19] \"VAL_COMP_ELEM2\"                 \"NOM_COMP_ELEM3\"                 #> [21] \"VAL_COMP_ELEM3\"                 \"NOM_COMP_ELEM4\"                 #> [23] \"VAL_COMP_ELEM4\"                 \"NOM_COMP_ELEM5\"                 #> [25] \"VAL_COMP_ELEM5\"                 \"LATITUDE\"                       #> [27] \"LONGITUDE\"                      \"NV_GEO_COORD\"                   #> [29] \"COD_ESPECIE\"                    \"DSC_ESTABELECIMENTO\"            #> [31] \"COD_INDICADOR_ESTAB_ENDERECO\"   \"COD_INDICADOR_CONST_ENDERECO\"   #> [33] \"COD_INDICADOR_FINALIDADE_CONST\" \"COD_TIPO_ESPECI\"                #> [35] \"geometry\" ## Opens the bundled Excel data dictionary: cnefe_dictionary(year = 2022)  ## Opens the bundled PDF methodological document: cnefe_doc(year = 2022)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"filtering-for-health-establishments","dir":"Articles","previous_headings":"","what":"Filtering for health establishments","title":"Reading and exploring CNEFE data","text":"can keep health establishments (COD_ESPECIE == 5):","code":"ssa_health <- ssa_cnefe |>   filter(COD_ESPECIE == 5)  nrow(ssa_health) #> [1] 1509"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"searching-for-hospital-in-the-description","dir":"Articles","previous_headings":"","what":"Searching for “hospital” in the description","title":"Reading and exploring CNEFE data","text":"can use grepl() within dplyr::filter() find records containing specific terms:","code":"ssa_hospitals <- ssa_health |>   filter(grepl(\"hospital\", DSC_ESTABELECIMENTO, ignore.case = TRUE))  ssa_hospitals #> Simple feature collection with 75 features and 34 fields #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: -38.53268 ymin: -13.00781 xmax: -38.36594 ymax: -12.86486 #> Geodetic CRS:  SIRGAS 2000 #> First 10 features: #>    COD_UNICO_ENDERECO COD_UF COD_MUNICIPIO COD_DISTRITO COD_SUBDISTRITO #> 1            27815649     29       2927408    292740805     29274080512 #> 2           217839825     29       2927408    292740805     29274080515 #> 3            91099415     29       2927408    292740805     29274080521 #> 4            28518541     29       2927408    292740805     29274080507 #> 5            28485049     29       2927408    292740805     29274080519 #> 6            28226794     29       2927408    292740805     29274080526 #> 7            90818500     29       2927408    292740805     29274080512 #> 8            27811802     29       2927408    292740805     29274080511 #> 9           195176533     29       2927408    292740805     29274080527 #> 10          192566810     29       2927408    292740805     29274080521 #>           COD_SETOR NUM_QUADRA NUM_FACE      CEP   DSC_LOCALIDADE #> 1  292740805120005P          1        1 40050003           NAZARE #> 2  292740805150210P          4        5 40440415 CAMINHO DE AREIA #> 3  292740805210329P          2        2 40330200             IAPI #> 4  292740805070382P          1        1 40255020           MATATU #> 5  292740805190107P          1       18 40711060           ESCADA #> 6  292740805260333P          9        1 41330065  CAJAZEIRAS VIII #> 7  292740805120021P          2        1 40050410           NAZARE #> 8  292740805110004P          1        3 40415031           BONFIM #> 9  292740805270001P          2       32 40226545        FEDERACAO #> 10 292740805210230P          1        1 40310000        PAU MIUDO #>    NOM_TIPO_SEGLOGR NOM_TITULO_SEGLOGR           NOM_SEGLOGR NUM_ENDERECO #> 1           AVENIDA               <NA>        JOANA ANGELICA          110 #> 2               RUA               <NA>       DUARTE DA COSTA            0 #> 3               RUA              CONDE       DE PORTO ALEGRE           11 #> 4               RUA               <NA>          CASTRO NEVES           17 #> 5           LADEIRA               <NA>          DA TEREZINHA            0 #> 6               RUA               <NA> ANGELINA GARCIA AVENA         2009 #> 7             PRACA        CONSELHEIRO         ALMEIDA COUTO          512 #> 8               RUA               <NA>   AUGUSTO DE MENDONCA            0 #> 9               RUA             DOUTOR      ARLINDO DE ASSIS            0 #> 10              RUA            MARQUES             DE MARICA            0 #>    DSC_MODIFICADOR NOM_COMP_ELEM1 VAL_COMP_ELEM1 NOM_COMP_ELEM2 VAL_COMP_ELEM2 #> 1             <NA>           <NA>           <NA>           <NA>           <NA> #> 2               SN          ANEXO   LATERAL HOSP           <NA>           <NA> #> 3             <NA>           <NA>           <NA>           <NA>           <NA> #> 4             <NA>           <NA>           <NA>           <NA>           <NA> #> 5               SN           <NA>           <NA>           <NA>           <NA> #> 6                2           <NA>           <NA>           <NA>           <NA> #> 7             <NA>           <NA>           <NA>           <NA>           <NA> #> 8               SN         PREDIO              1           <NA>           <NA> #> 9               SN           <NA>           <NA>           <NA>           <NA> #> 10              SN           <NA>           <NA>           <NA>           <NA> #>    NOM_COMP_ELEM3 VAL_COMP_ELEM3 NOM_COMP_ELEM4 VAL_COMP_ELEM4 NOM_COMP_ELEM5 #> 1            <NA>           <NA>           <NA>           <NA>           <NA> #> 2            <NA>           <NA>           <NA>           <NA>           <NA> #> 3            <NA>           <NA>           <NA>           <NA>           <NA> #> 4            <NA>           <NA>           <NA>           <NA>           <NA> #> 5            <NA>           <NA>           <NA>           <NA>           <NA> #> 6            <NA>           <NA>           <NA>           <NA>           <NA> #> 7            <NA>           <NA>           <NA>           <NA>           <NA> #> 8            <NA>           <NA>           <NA>           <NA>           <NA> #> 9            <NA>           <NA>           <NA>           <NA>           <NA> #> 10           <NA>           <NA>           <NA>           <NA>           <NA> #>    VAL_COMP_ELEM5  LATITUDE LONGITUDE NV_GEO_COORD COD_ESPECIE #> 1            <NA> -12.97484 -38.50243            1           5 #> 2            <NA> -12.92919 -38.50526            1           5 #> 3            <NA> -12.95778 -38.48798            1           5 #> 4            <NA> -12.97707 -38.49978            1           5 #> 5            <NA> -12.88256 -38.48162            1           5 #> 6            <NA> -12.90013 -38.41087            1           5 #> 7            <NA> -12.97188 -38.50293            1           5 #> 8            <NA> -12.92953 -38.50912            1           5 #> 9            <NA> -12.99757 -38.51595            4           5 #> 10           <NA> -12.95874 -38.48849            1           5 #>                         DSC_ESTABELECIMENTO COD_INDICADOR_ESTAB_ENDERECO #> 1                                  HOSPITAL                            1 #> 2                     HOSPITAL AGENOR PAIVA                            1 #> 3                    HOSPITAL ESPECIALIZADO                            1 #> 4                      HOSPITAL DO EXERCITO                            1 #> 5                 HAC HOSPITAL ALAYDE COSTA                            1 #> 6               2 ANEXO DO HOSPITAL PROHOPE                            1 #> 7           HOSPITAL PROFESSOR CARVALHO LUZ                            1 #> 8  CENTRO MEDICO HOSPITALAR DA POLICIA MILI                            1 #> 9                      HOSPITAL SANTO AMARO                            1 #> 10            HOSPITAL GERAL ERNESTO SIMOES                            1 #>    COD_INDICADOR_CONST_ENDERECO COD_INDICADOR_FINALIDADE_CONST COD_TIPO_ESPECI #> 1                            NA                             NA              NA #> 2                            NA                             NA              NA #> 3                            NA                             NA              NA #> 4                            NA                             NA              NA #> 5                            NA                             NA              NA #> 6                            NA                             NA              NA #> 7                            NA                             NA              NA #> 8                            NA                             NA              NA #> 9                            NA                             NA              NA #> 10                           NA                             NA              NA #>                       geometry #> 1  POINT (-38.50243 -12.97484) #> 2  POINT (-38.50526 -12.92919) #> 3  POINT (-38.48798 -12.95778) #> 4  POINT (-38.49978 -12.97707) #> 5  POINT (-38.48162 -12.88256) #> 6  POINT (-38.41087 -12.90013) #> 7  POINT (-38.50293 -12.97188) #> 8  POINT (-38.50912 -12.92953) #> 9  POINT (-38.51595 -12.99757) #> 10 POINT (-38.48849 -12.95874)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"mapping-the-results","dir":"Articles","previous_headings":"","what":"Mapping the results","title":"Reading and exploring CNEFE data","text":"Since already sf object, can visualise locations directly mapview:","code":"library(mapview)  mapview(ssa_hospitals, layer.name = \"Health facilities with 'hospital' term in their description column in Salvador\")"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/read_cnefe.html","id":"working-with-arrow-tables-for-better-performance","dir":"Articles","previous_headings":"","what":"Working with Arrow tables for better performance","title":"Reading and exploring CNEFE data","text":"default, read_cnefe() returns Arrow table instead sf object. Arrow tables memory-efficient faster large municipalities, makes better choice need filter transform data converting spatial format: Arrow, can filter data loading memory collect(), convert subset need sf: approach particularly useful working large municipalities loading records sf may slow.","code":"ssa_arrow <- read_cnefe(code_muni = 2927408, cache = TRUE)  class(ssa_arrow) #> [1] \"Table\"        \"ArrowTabular\" \"ArrowObject\"  \"R6\" ssa_hospitals_arrow <- ssa_arrow |>   filter(COD_ESPECIE == 5) |>   filter(grepl(\"hospital\", DSC_ESTABELECIMENTO, ignore.case = TRUE)) |>   collect() |>   filter(!is.na(LONGITUDE), !is.na(LATITUDE)) |>   st_as_sf(     coords = c(\"LONGITUDE\", \"LATITUDE\"),     crs = 4674   )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Dasymetric interpolation using CNEFE addresses","text":"","code":"library(dplyr)  library(ggplot2) library(sf) library(mapview) library(leafsync)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"part-1-census-variables-on-h3-hexagons-fortaleza","dir":"Articles","previous_headings":"","what":"Part 1: Census variables on H3 hexagons (Fortaleza)","title":"Dasymetric interpolation using CNEFE addresses","text":"interpolate three census variables H3 resolution 8 hexagons Fortaleza (IBGE code 2304400): pop_ph: population private households avg_inc_resp: average income household heads race_preta: population self-identified Black (preta)","code":"ftl_h3 <- tracts_to_h3(   code_muni = 2304400,   h3_resolution = 8,   vars = c(\"pop_ph\", \"avg_inc_resp\", \"race_preta\") ) #> ℹ Processing code 2304400 #> ℹ Step 1/6: connecting to DuckDB and loading extensions... #> ✔ Spatial extension loaded #> ℹ Step 1/6: connecting to DuckDB and loading extensions... ✔ Step 1/6 (DuckDB ready) [535ms] #>  #> ℹ Step 2/6: preparing census tracts in DuckDB... #> ℹ Using cached file: 'sc_23.parquet' #> ℹ Step 2/6: preparing census tracts in DuckDB... ✔ Step 2/6 (Tracts ready) [304ms] #>  #> ℹ Step 3/6: preparing CNEFE points in DuckDB... #> ℹ Using cached file: C:\\Users\\jorge\\AppData\\Local/R/cache/R/cnefetools/2304400_FORTALEZA.zip #> ℹ Step 3/6: preparing CNEFE points in DuckDB... ✔ Step 3/6 (CNEFE points ready) [3.8s] #>  #> ℹ Step 4/6: spatial join (points to tracts) and allocation prep... #> ✔ Step 4/6 (Join and allocation) [1.4s] #>  #> ℹ Step 5/6: aggregating allocated values to H3 cells... #> ✔ Step 5/6 (Hex aggregation) [202ms] #>  #> ℹ Step 6/6: building H3 grid and joining results... #> ✔ Step 6/6 (sf output) [841ms] #>  #>  #> ── Dasymetric interpolation diagnostics ── #>  #> ── Stage 1: Tracts → CNEFE points  #> ! Unallocated total for population from private households (pop_ph): 2169 of #>   2424722 (0.09%) #> ! Unallocated total for race_preta (race_preta): 74 of 170887 (0.04%) #> ! avg_inc_resp assigned to 1032500 of 1033953 eligible points (99.86% of total #>   points) #> ! avg_inc_resp is NA in 128 of 4408 tracts (2.90% of total tracts) #> ! Unmatched CNEFE points (no tract): 194 of 1034611 points (0.02% of total #>   points) #> ! Tracts with NA totals: pop_ph in 128 of 4408 tracts (2.90% of total tracts); #>   race_preta in 200 of 4408 tracts (4.54% of total tracts) #> ! Tracts with no eligible dwellings: pop_ph in 6 of 4408 tracts (0.14% of total #>   tracts); race_preta in 6 of 4408 tracts (0.14% of total tracts) #>  #> ── Stage 2: CNEFE points → H3 hexagons  #> ℹ CNEFE points mapped to H3 cells: 1034417 of 1034417 allocated points #>   (100.00%)  head(ftl_h3) #> Simple feature collection with 6 features and 4 fields #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: -38.58679 ymin: -3.87537 xmax: -38.46354 ymax: -3.699103 #> Geodetic CRS:  WGS 84 #>            id_hex    pop_ph avg_inc_resp race_preta #> 1 8880104e4bfffff  9150.592     1545.129   711.0133 #> 2 8880104e99fffff 15536.179     1631.154  1218.6971 #> 3 8880107b2dfffff 17212.677     1529.253  1383.9257 #> 4 8880104e07fffff  5313.651     2340.135   410.9158 #> 5 88801040e7fffff  4662.678     1317.024   335.7955 #> 6 8880104c2dfffff  5116.131     5522.949   257.8724 #>                         geometry #> 1 POLYGON ((-38.52546 -3.8373... #> 2 POLYGON ((-38.58093 -3.7591... #> 3 POLYGON ((-38.57127 -3.7094... #> 4 POLYGON ((-38.51305 -3.8031... #> 5 POLYGON ((-38.51409 -3.8753... #> 6 POLYGON ((-38.46756 -3.7471..."},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"mapping-the-results","dir":"Articles","previous_headings":"Part 1: Census variables on H3 hexagons (Fortaleza)","what":"Mapping the results","title":"Dasymetric interpolation using CNEFE addresses","text":"use leafsync::sync() display three variables side side:","code":"map_pop <- mapview(   ftl_h3,   zcol = \"pop_ph\",   layer.name = \"Population\" )  map_inc <- mapview(   ftl_h3,   zcol = \"avg_inc_resp\",   layer.name = \"Avg. income\" )  map_race <- mapview(   ftl_h3,   zcol = \"race_preta\",   layer.name = \"Black pop.\" )  sync(map_pop, map_inc, map_race, ncol = 3)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"exploring-the-relationship-between-income-and-racial-composition","dir":"Articles","previous_headings":"Part 1: Census variables on H3 hexagons (Fortaleza)","what":"Exploring the relationship between income and racial composition","title":"Dasymetric interpolation using CNEFE addresses","text":"can examine relationship average household head income proportion Black population hexagon:  expected, plot reveals strong negative correlation two variables: hexagons lower average household income tend substantially higher share Black population. pattern reflects deep-rooted racial income inequality, persistent feature Brazilian social landscape.","code":"ftl_h3_plot <- ftl_h3 |>   st_drop_geometry() |>   filter(pop_ph > 0) |>   mutate(pct_preta = race_preta / pop_ph)  ggplot(ftl_h3_plot, aes(x = avg_inc_resp, y = pct_preta)) +   geom_point(alpha = 0.3, size = 3) +   geom_smooth(method = \"loess\", se = TRUE, color = \"steelblue\") +   scale_y_continuous(labels = scales::percent_format()) +   labs(     x = \"Average income of household heads (R$)\",     y = \"Black population share (race_preta / pop_ph)\"   ) +   theme_minimal()"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"part-2-census-variables-on-traffic-zones-são-paulo","dir":"Articles","previous_headings":"","what":"Part 2: Census variables on traffic zones (São Paulo)","title":"Dasymetric interpolation using CNEFE addresses","text":"Transportation planning often requires census-derived variables traffic zone level rather census tract level. odbr package provides traffic zone geometries origin-destination surveys conducted Brazilian metropolitan areas. Since OD survey São Paulo covers entire metropolitan region (39 municipalities), filter traffic zones within municipality São Paulo. interpolate two variables: pop_ph: population private households age_70m: population aged 70 years older","code":"library(odbr)  # Load traffic zones for the São Paulo metropolitan region sp_zones <- read_map(   city = \"Sao Paulo\",   year = 2017,   geometry = \"zone\" )  # Filter zones within the municipality of São Paulo sp_zones_muni <- sp_zones |>   filter(NomeMunici == \"São Paulo\") |>    sf::st_make_valid() # Correcting invalid geometries in advance  nrow(sp_zones_muni) #> [1] 342 sp_zones_census <- tracts_to_polygon(   code_muni = 3550308,   polygon = sp_zones_muni,    vars = c(\"pop_ph\", \"age_70m\") ) #> ℹ Processing municipality code 3550308... #> ℹ Step 1/6: aligning CRS... #> ℹ Input CRS: \"EPSG:22523\" | Output CRS: \"EPSG:22523\" #> ℹ Step 1/6: aligning CRS... ✔ Step 1/6 (CRS alignment) [275ms] #>  #> ℹ Step 2/6: connecting to DuckDB and loading extensions... #> ✔ Spatial extension loaded #> ℹ Step 2/6: connecting to DuckDB and loading extensions... ✔ Step 2/6 (DuckDB ready) [510ms] #>  #> ℹ Step 3/6: preparing census tracts in DuckDB... #> ℹ Using cached file: 'sc_35.parquet' #> ℹ Step 3/6: preparing census tracts in DuckDB... ✔ Step 3/6 (Tracts ready) [4.9s] #>  #> ℹ Step 4/6: preparing CNEFE points in DuckDB... #> ℹ Using cached file: C:\\Users\\jorge\\AppData\\Local/R/cache/R/cnefetools/3550308_SAO_PAULO.zip #> ℹ Step 4/6: preparing CNEFE points in DuckDB... ✔ Step 4/6 (CNEFE points ready) [15.8s] #>  #> ℹ Step 5/6: spatial join (points to tracts) and allocation... #> ✔ Step 5/6 (Join and allocation) [51.1s] #>  #> ℹ Step 6/6: aggregating allocated values to polygons... #> ✔ Step 6/6 (Polygon aggregation) [340ms] #>  #>  #> ── Dasymetric interpolation diagnostics ── #>  #> ── Stage 1: Tracts → CNEFE points  #> ! Unallocated total for population from private households (pop_ph): 86998 of #>   11394071 (0.76%) #> ! Unallocated total for age_70m (age_70m): 5397 of 923921 (0.58%) #> ! Unmatched CNEFE points (no tract): 2935 of 4996529 points (0.06% of total #>   points) #> ! Tracts with NA totals: pop_ph in 622 of 27301 tracts (2.28% of total tracts); #>   age_70m in 1316 of 27301 tracts (4.82% of total tracts). #> ! Tracts with no eligible dwellings: pop_ph in 324 of 27301 tracts (1.19% of #>   total tracts); age_70m in 297 of 27301 tracts (1.09% of total tracts) #>  #> ── Stage 2: CNEFE points → Polygons  #> ℹ Polygon coverage: 4993321 of 4993594 allocated points captured (99.99%) #> ℹ Polygons with no CNEFE points: 3 of 342 total polygons (0.88%)  head(sp_zones_census) #> Simple feature collection with 6 features and 9 fields #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: 331820.5 ymin: 7393922 xmax: 334180.5 ymax: 7396311 #> Projected CRS: Corrego Alegre 1970-72 / UTM zone 23S #> # A tibble: 6 × 10 #>   NumeroZona NomeZona      NumeroMuni NomeMunici NumDistrit NomeDistri Area_ha_2 #>        <dbl> <chr>              <dbl> <chr>           <dbl> <chr>          <dbl> #> 1          1 Sé                    36 São Paulo          80 Sé              57.1 #> 2          2 Parque Dom P…         36 São Paulo          80 Sé             114.  #> 3          3 Praça João M…         36 São Paulo          80 Sé              47.8 #> 4          4 Ladeira da M…         36 São Paulo          67 República       75.1 #> 5          5 República             36 São Paulo          67 República       75.0 #> 6          6 Santa Ifigên…         36 São Paulo          67 República       82.9 #> # ℹ 3 more variables: geom <POLYGON [m]>, pop_ph <dbl>, age_70m <dbl>"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"mapping-the-elderly-population-share","dir":"Articles","previous_headings":"Part 2: Census variables on traffic zones (São Paulo)","what":"Mapping the elderly population share","title":"Dasymetric interpolation using CNEFE addresses","text":"compute share population aged 70+ traffic zone. indicator relevant identifying areas transport planning prioritize accessibility people reduced mobility, low-floor buses, accessible sidewalks, demand-responsive transit services.","code":"sp_zones_ratio <- sp_zones_census |>   filter(pop_ph > 0) |>   mutate(pct_70m = age_70m / pop_ph)  mapview(   sp_zones_ratio,   zcol = \"pct_70m\",   layer.name = \"Share of pop. aged 70+\" )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"notes","dir":"Articles","previous_headings":"","what":"Notes","title":"Dasymetric interpolation using CNEFE addresses","text":"Notice tracts_to_polygon() particularly useful transportation research, census variables (population age group income) essential inputs travel demand models (especially Trip Generation models 4-Step modeling). However, traffic zone geometries rarely align census tract boundaries. Dasymetric interpolation via CNEFE dwelling points provides principled method bridge spatial mismatch, transferring census data custom spatial units supporting accurate trip generation distribution models.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"hint-to-scaling-to-multiple-municipalities","dir":"Articles","previous_headings":"Notes","what":"Hint to scaling to multiple municipalities","title":"Dasymetric interpolation using CNEFE addresses","text":"odbr traffic zones cover entire São Paulo metropolitan region (39 municipalities). interpolate census data municipalities, can use purrr::map() apply tracts_to_polygon() municipality combine results dplyr::bind_rows().","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"future-versions","dir":"Articles","previous_headings":"Notes","what":"Future versions","title":"Dasymetric interpolation using CNEFE addresses","text":"future versions package, tracts_to_polygon() support municipality-independent operation, allowing users pass polygons span multiple municipalities without need per-municipality iteration.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"interpolation-diagnostics","dir":"Articles","previous_headings":"Notes","what":"Interpolation diagnostics","title":"Dasymetric interpolation using CNEFE addresses","text":"functions print detailed diagnostics run, user can assess quality interpolation. example, tracts_to_h3() call Fortaleza produces: tracts_to_polygon() call São Paulo: warnings report amount unallocated population (percentage census total), number CNEFE points matched tract, number tracts missing values eligible dwellings. examples, unallocated shares small (1%), indicating interpolation preserves original census totals. Users inspect diagnostics decide whether loss acceptable application.","code":"── Dasymetric interpolation diagnostics ── ! Unallocated total for population from private households (pop_ph): \"2169\" (\"0.09%\" of total) ! Unallocated total for race_preta (race_preta): \"74\" (\"0.04%\" of total) ! avg_inc_resp assigned to 1032500 of 1033953 eligible points ! avg_inc_resp is \"NA\" in 128 tracts ! Unmatched CNEFE points (no tract): 194 ! Tracts with \"NA\" totals: pop_ph \"NA\" in 128; race_preta \"NA\" in 200 ! Tracts with no eligible dwellings: pop_ph in 6 tracts; race_preta in 6 tracts ── Dasymetric interpolation diagnostics ── ! Unallocated total for population from private households (pop_ph): \"86998\" (\"0.76%\" of total) ! Unallocated total for age_70m (age_70m): \"5397\" (\"0.58%\" of total) ! Unmatched CNEFE points (no tract) = 2935 ! Tracts with \"NA\" totals: pop_ph \"NA\" in 622; age_70m \"NA\" in 1316 ! Tracts with no eligible dwellings: pop_ph in 324 tracts; age_70m in 297 tracts"},{"path":"https://pedreirajr.github.io/cnefetools/dev/articles/tracts_to.html","id":"ecological-fallacy-caveat","dir":"Articles","previous_headings":"Notes","what":"Ecological fallacy caveat","title":"Dasymetric interpolation using CNEFE addresses","text":"Dasymetric interpolation distributes tract-level aggregates dwelling points assumption dwelling within tract receives equal share total. means method recover true individual- dwelling-level values; redistributes group statistic. Drawing conclusions individuals aggregated data constitutes ecological fallacy (error attributing group-level patterns individuals). risk greater source census tracts large, since larger tracts likely contain internally heterogeneous populations, making uniform allocation assumption less realistic. Users interpret interpolated values spatial estimates aggregate quantities, precise measurements dwelling individual level.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Jorge Ubirajara Pedreira Junior. Author, maintainer, copyright holder. Bruno Mioto. Author. Kaio Cunha Pedreira. Contributor.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Pedreira Junior J, Mioto B (2026). cnefetools: Tools Working Brazilian CNEFE 2022 Address Data. R package version 0.2.0.9000, https://github.com/pedreirajr/cnefetools.","code":"@Manual{,   title = {cnefetools: Tools for Working with Brazilian CNEFE 2022 Address Data},   author = {Jorge Ubirajara {Pedreira Junior} and Bruno Mioto},   year = {2026},   note = {R package version 0.2.0.9000},   url = {https://github.com/pedreirajr/cnefetools}, }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"cnefetools-tools-for-working-with-brazilian-cnefe-address-data-","dir":"","previous_headings":"","what":"Tools for Working with Brazilian CNEFE 2022 Address Data","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"{cnefetools} provides helper functions efficiently work 2022 Brazilian National Address File Statistical Purposes (Cadastro Nacional de Endereços para Fins Estatísticos, CNEFE), address-level dataset released Brazilian Institute Geography Statistics (Instituto Brasileiro de Geografia e Estatística, IBGE).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"Install stable version CRAN: install development version GitHub:","code":"install.packages(\"cnefetools\") # install.packages(\"pak\") pak::pak(\"pedreirajr/cnefetools\")  # or # install.packages(\"remotes\") remotes::install_github(\"pedreirajr/cnefetools\")"},{"path":[]},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"reading-cnefe-data","dir":"","previous_headings":"","what":"Reading CNEFE data","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"read_cnefe() downloads reads CNEFE CSV municipality, returning Arrow table default: Setting output = \"sf\" returns sf object instead. example reads data Salvador, filters religious facilities (COD_ESPECIE == 8), plots :  Warning: large municipalities, CNEFE may contain 1 million address points. Plotting coordinates can slow memory-intensive, consider filtering sampling creating maps.","code":"library(cnefetools) library(dplyr)  # Read CNEFE data for Salvador as an Arrow table tab_ssa <- read_cnefe(2927408, cache = TRUE)  tab_ssa |>   collect() |> # materialize the arrow table in R   tibble() |>   head() #> # A tibble: 6 × 34 #>   COD_UNICO_ENDERECO COD_UF COD_MUNICIPIO COD_DISTRITO COD_SUBDISTRITO COD_SETOR #>                <int>  <int>         <int>        <int>         <int64> <chr>     #> 1          222386741     29       2927408    292740805     29274080518 29274080… #> 2           27995350     29       2927408    292740805     29274080522 29274080… #> 3           28034841     29       2927408    292740805     29274080522 29274080… #> 4          217544957     29       2927408    292740805     29274080518 29274080… #> 5          217639781     29       2927408    292740805     29274080526 29274080… #> 6          217639701     29       2927408    292740805     29274080526 29274080… #> # ℹ 28 more variables: NUM_QUADRA <int>, NUM_FACE <int>, CEP <int>, #> #   DSC_LOCALIDADE <chr>, NOM_TIPO_SEGLOGR <chr>, NOM_TITULO_SEGLOGR <chr>, #> #   NOM_SEGLOGR <chr>, NUM_ENDERECO <int>, DSC_MODIFICADOR <chr>, #> #   NOM_COMP_ELEM1 <chr>, VAL_COMP_ELEM1 <chr>, NOM_COMP_ELEM2 <chr>, #> #   VAL_COMP_ELEM2 <chr>, NOM_COMP_ELEM3 <chr>, VAL_COMP_ELEM3 <chr>, #> #   NOM_COMP_ELEM4 <chr>, VAL_COMP_ELEM4 <chr>, NOM_COMP_ELEM5 <chr>, #> #   VAL_COMP_ELEM5 <chr>, LATITUDE <dbl>, LONGITUDE <dbl>, … library(sf) library(ggplot2)  # Reading CNEFE data tab_ssa_sf <- read_cnefe(   code_muni = 2927408,    output = \"sf\",    cache = TRUE   )  # Filtering religious establishments temples_ssa <- tab_ssa_sf |>   filter(COD_ESPECIE == 8)  # Ploting religious establishments points for Salvador ggplot() +   geom_sf(data = temples_ssa, size = 0.3, alpha = 0.6) +   coord_sf() +   theme_minimal()"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"caching-behavior","dir":"","previous_headings":"","what":"Caching behavior","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"default, cache = TRUE stores downloaded ZIP file user-level cache directory specific package. prefer avoid persistent caching, set: case, ZIP file stored temporary location removed reading.","code":"tab_ssa <- read_cnefe(code_muni = 2927408, cache = FALSE)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"accessing-official-cnefe-documentation","dir":"","previous_headings":"","what":"Accessing official CNEFE documentation","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"{cnefetools} includes local copies official methodological note variable dictionary 2022 CNEFE released IBGE.","code":"# Open the official methodological note (PDF) cnefe_doc(year = 2022)  # Open the official variable dictionary (.xls spreadsheet) cnefe_dictionary(year = 2022)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"counting-addresses-with-cnefe_counts","dir":"","previous_headings":"","what":"Counting addresses with cnefe_counts()","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"cnefe_counts() aggregates CNEFE address points spatial units returns sf object counts address category (addr_type1 addr_type8). example using H3 hexagons São Paulo resolution 9: plot count private households (addr_type1) per hexagon:  cnefe_counts() also supports polygon_type = \"user\" aggregate counts custom polygons instead H3 hexagons. See cnefe_counts article details.","code":"library(cnefetools) library(sf) library(ggplot2)  # Producing CNEFE counts hex_sp <- cnefe_counts(   code_muni = 3550308,   h3_resolution = 9,   verbose = TRUE   ) # Plotting private households (addr_type1) for São Paulo ggplot(hex_sp) +   geom_sf(aes(fill = addr_type1), color = NA) +   scale_fill_viridis_c(option = \"magma\") +   coord_sf() +   labs(     fill = \"Count\",     title = \"Private households (addr_type1)\",     subtitle = \"São Paulo (IBGE 3550308), H3 resolution 9\"   ) +   theme_minimal()+   theme(     plot.title.position = \"plot\"   )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"land-use-mix-indices-with-compute_lumi","dir":"","previous_headings":"","what":"Land-use mix indices with compute_lumi()","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"compute_lumi() computes land-use mix indicators spatial units municipality covered 2022 CNEFE dataset (Pedreira Junior et al., 2025). Available indicators include Entropy Index (ei), Herfindahl-Hirschman Index (hhi), Balance Index (bal), Index Concentration Extremes (ice), adapted HHI (hhi_adp), Bidirectional Global-centered Balance Index (bgbi). example Fortaleza H3 resolution 8: plot Bidirectional Global-centered Balance Index (BGBI), positive values indicate residential dominance negative values indicate non-residential dominance:  compute_lumi() also supports polygon_type = \"user\" compute indices custom polygons. See compute_lumi article details.","code":"library(cnefetools) library(sf) library(ggplot2)  # Computing land use mix indices lumi_ftl <- compute_lumi(   code_muni = 2304400,   h3_resolution = 8,   verbose = TRUE   ) # Plotting the BGBI index ggplot(lumi_ftl) +   geom_sf(aes(fill = bgbi), color = NA) +   scale_fill_distiller(     type = \"div\",     palette = \"RdBu\",     direction = 1   ) +   coord_sf() +   labs(     fill = \"BGBI\",     title = \"Bidirectional Global-centered Balance Index (BGBI)\",     subtitle = \"Fortaleza (IBGE 2304400), H3 resolution 8\"   ) +   theme_minimal()+   theme(     plot.title.position = \"plot\"   )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"dasymetric-interpolation-with-tracts_to_h3","dir":"","previous_headings":"","what":"Dasymetric interpolation with tracts_to_h3()","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"tracts_to_h3() performs dasymetric interpolation, considering two stages: first, census tract totals allocated individual CNEFE dwelling points inside tract; , allocated values aggregated H3 grid chosen resolution. leverages fine-grained spatial distribution addresses CNEFE produce realistic sub-tract estimates simple areal weighting. resulting H3 grid can mapped visualize spatial distribution variable. plot private-household population (pop_ph):  average income household head (avg_inc_resp):  full list available variables documented tracts_variables_ref dataset (see ?tracts_variables_ref). allocation rules diagnostic details, see tracts_to article.","code":"library(cnefetools) library(ggplot2)  # Performing dasymetric interpolation rec_hex <- tracts_to_h3(   code_muni = 2611606,   h3_resolution = 9,   vars = c(\"pop_ph\", \"avg_inc_resp\"),   cache = TRUE,   verbose = TRUE ) ggplot(rec_hex) +   geom_sf(aes(fill = pop_ph), color = NA) +   scale_fill_viridis_c() +   coord_sf() +   labs(     title = \"Dasymetric interpolation to H3 using CNEFE (Recife)\",     subtitle = \"Private-household population (pop_ph), H3 resolution 9\",     fill = \"Population\"   ) +   theme_minimal() +   theme(     plot.title.position = \"plot\"   ) ggplot(rec_hex) +   geom_sf(aes(fill = avg_inc_resp), color = NA) +   scale_fill_viridis_c() +   coord_sf() +   labs(     title = \"Dasymetric interpolation to H3 using CNEFE (Recife)\",     subtitle = \"Average income of the responsible person (avg_inc_resp), H3 resolution 9\",     fill = \"Income\"   ) +   theme_minimal() +   theme(     plot.title.position = \"plot\"   )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"dasymetric-interpolation-with-tracts_to_polygon","dir":"","previous_headings":"","what":"Dasymetric interpolation with tracts_to_polygon()","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"tracts_to_polygon() follows two-stage workflow tracts_to_h3(), aggregates allocated values user-provided polygons (e.g. neighborhoods, administrative divisions, custom areas) instead H3 grid. Let’s generate neighborhoods Recife read_neighborhood() function geobr package interpolate average income household heads per neighborhood: plot interpolated average income household head (avg_inc_resp) neighborhood level:  See tracts_to article details.","code":"library(geobr)  # Reading neighborhoods from geobr package rec_nei <- read_neighborhood(year = 2022, simplified = F, showProgress = F) |>   filter(name_muni == 'Recife')  # Dasymetric interpolation to neighborhoods rec_poly <- tracts_to_polygon(   code_muni = 2611606,   polygon = rec_nei,   vars = c(\"pop_ph\", \"avg_inc_resp\"),   verbose = F ) # Plotting variables at the neighborhood level ggplot(rec_poly) +   geom_sf(aes(fill = avg_inc_resp), color = NA) +   scale_fill_viridis_c() +   coord_sf() +   labs(     title = \"Dasymetric interpolation to neighborhoods using CNEFE (Recife)\",     subtitle = \"Average income of the responsible person (avg_inc_resp)\",     fill = \"Income\"   ) +   theme_minimal() +   theme(     plot.title.position = \"plot\"   )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"duckdb-powered-spatial-operations","dir":"","previous_headings":"","what":"DuckDB-powered spatial operations","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"hood, {cnefetools} uses DuckDB default backend perform spatial operations efficiently, speedups 5–40x pure-R code depending number address points size spatial units. made possible three DuckDB extensions: spatial: performs spatial joins (e.g., point--polygon) SQL, used aggregating user-provided polygons performing dasymetric interpolation. zipfs: reads CSV files directly cached ZIP archives, avoiding need extract files disk. h3: assigns geographic coordinates H3 hexagonal grid cells entirely inside DuckDB. R package duckspatial also bridges sf objects DuckDB’s spatial extension, enabling seamless transfers R DuckDB. extensions installed loaded automatically first use. pure-R fallback (backend = \"r\") also available, using h3jsr sf operations cnefe_counts() compute_lumi() functions (slower, without DuckDB dependency).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Tools for Working with Brazilian CNEFE 2022 Address Data","text":"use {cnefetools} work, please cite associated preprint: Pedreira Jr., J. U.; Louro, T. V.; Assis, L. B. M.; Brito, P. L. Measuring land use mix address-level census data (2025). engrXiv. https://engrxiv.org/preprint/view/5975","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/build_h3_grid.html","id":null,"dir":"Reference","previous_headings":"","what":"Build an H3 grid as an sf object — build_h3_grid","title":"Build an H3 grid as an sf object — build_h3_grid","text":"Internal helper build H3 grid either: vector H3 cell ids (id_hex), municipality boundary (code_muni) using geobr (year fixed 2024).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/build_h3_grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Build an H3 grid as an sf object — build_h3_grid","text":"","code":"build_h3_grid(h3_resolution, id_hex = NULL, code_muni = NULL, boundary = NULL)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/build_h3_grid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Build an H3 grid as an sf object — build_h3_grid","text":"h3_resolution Integer. H3 resolution. id_hex Character/integer vector H3 cell ids (optional). code_muni Integer. Seven-digit IBGE municipality code (optional). boundary sf polygon area interest (optional).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/build_h3_grid.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Build an H3 grid as an sf object — build_h3_grid","text":"sf object (CRS 4326) columns id_hex geometry.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":null,"dir":"Reference","previous_headings":"","what":"Count CNEFE address species on a spatial grid — cnefe_counts","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"cnefe_counts() reads CNEFE records given municipality, assigns address point spatial units (either H3 hexagonal cells user-provided polygons), returns per-unit counts COD_ESPECIE addr_type1 addr_type8.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"","code":"cnefe_counts(   code_muni,   year = 2022,   polygon_type = c(\"hex\", \"user\"),   polygon = NULL,   crs_output = NULL,   h3_resolution = 9,   verbose = TRUE,   backend = c(\"duckdb\", \"r\") )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"code_muni Integer. Seven-digit IBGE municipality code. year Integer. CNEFE data year. Currently 2022 supported. Defaults 2022. polygon_type Character. Type polygon aggregation: \"hex\" (default) uses H3 hexagonal grid; \"user\" uses polygons provided via polygon parameter. polygon sf::sf object polygon geometries. Required polygon_type = \"user\". warning issued reporting percentage CNEFE points covered polygon area. CNEFE points fall within polygon, error raised. crs_output CRS output object. used polygon_type = \"user\". Default NULL, uses original CRS polygon argument. Can EPSG code (e.g., 4326, 31983) CRS object accepted sf::st_transform(). h3_resolution Integer. H3 grid resolution (default: 9). used polygon_type = \"hex\". verbose Logical; TRUE, prints messages timing information. backend Character. \"duckdb\" (default) uses DuckDB H3/spatial extensions. \"r\" uses h3jsr sf R (slower DuckDB dependency).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"sf::sf object containing: id_hex (polygon_type = \"hex\"): H3 cell identifier Original columns polygon (polygon_type = \"user\") addr_type1 ... addr_type8: counts per address type geometry: polygon geometry polygon_type = \"user\", output CRS matches original polygon CRS (crs_output specified).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"counts columns addr_type1 addr_type8 correspond : addr_type1: Private household (Domicílio particular) addr_type2: Collective household (Domicílio coletivo) addr_type3: Agricultural establishment (Estabelecimento agropecuário) addr_type4: Educational establishment (Estabelecimento de ensino) addr_type5: Health establishment (Estabelecimento de saúde) addr_type6: Establishment purposes (Estabelecimento de outras finalidades) addr_type7: Building construction renovation (Edificação em construção ou reforma) addr_type8: Religious establishment (Estabelecimento religioso)","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_counts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Count CNEFE address species on a spatial grid — cnefe_counts","text":"","code":"if (FALSE) { # \\dontrun{ # Count addresses per H3 hexagon (resolution 9) hex_counts <- cnefe_counts(code_muni = 2929057)  # Count addresses per user-provided polygon (neighborhoods of Lauro de Freitas-BA) # Using geobr to download neighborhood boundaries library(geobr) nei_ldf <- subset(   read_neighborhood(year = 2022),   code_muni == 2919207 ) hex_counts <- cnefe_counts(   code_muni = 2919207,   polygon_type = \"user\",   polygon = nei_ldf ) } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_dictionary.html","id":null,"dir":"Reference","previous_headings":"","what":"Open the official CNEFE data dictionary — cnefe_dictionary","title":"Open the official CNEFE data dictionary — cnefe_dictionary","text":"Opens bundled Excel data dictionary system's default spreadsheet viewer (e.g., Excel, LibreOffice).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_dictionary.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Open the official CNEFE data dictionary — cnefe_dictionary","text":"","code":"cnefe_dictionary(year = 2022)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_dictionary.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Open the official CNEFE data dictionary — cnefe_dictionary","text":"year Integer. CNEFE data year. Currently 2022 supported.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_dictionary.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Open the official CNEFE data dictionary — cnefe_dictionary","text":"Invisibly, path Excel file inside installed package.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_dictionary.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Open the official CNEFE data dictionary — cnefe_dictionary","text":"","code":"if (FALSE) { # \\dontrun{ cnefe_dictionary() } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_doc.html","id":null,"dir":"Reference","previous_headings":"","what":"Open the official CNEFE methodological note — cnefe_doc","title":"Open the official CNEFE methodological note — cnefe_doc","text":"Opens bundled PDF methodological document system's default PDF viewer.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_doc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Open the official CNEFE methodological note — cnefe_doc","text":"","code":"cnefe_doc(year = 2022)"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_doc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Open the official CNEFE methodological note — cnefe_doc","text":"year Integer. CNEFE data year. Currently 2022 supported.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_doc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Open the official CNEFE methodological note — cnefe_doc","text":"Invisibly, path PDF file inside installed package.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefe_doc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Open the official CNEFE methodological note — cnefe_doc","text":"","code":"if (FALSE) { # \\dontrun{ cnefe_doc() } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefetools-package.html","id":null,"dir":"Reference","previous_headings":"","what":"cnefetools: Tools for Working with Brazilian CNEFE 2022 Address Data — cnefetools-package","title":"cnefetools: Tools for Working with Brazilian CNEFE 2022 Address Data — cnefetools-package","text":"Provides helper functions work Cadastro Nacional de Endereços para Fins Estatísticos (CNEFE) 2022 Brazilian census. initial version focuses efficiently downloading, caching, reading municipality-level CNEFE CSV files Arrow tables downstream analysis.","code":""},{"path":[]},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/cnefetools-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"cnefetools: Tools for Working with Brazilian CNEFE 2022 Address Data — cnefetools-package","text":"Maintainer: Jorge Ubirajara Pedreira Junior jorge.ubirajara@ufba.br (ORCID) [copyright holder] Authors: Bruno Mioto brunomioto97@gmail.com contributors: Kaio Cunha Pedreira kaiocp7@gmail.com [contributor]","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute land-use mix indicators on a spatial grid — compute_lumi","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"compute_lumi() reads CNEFE records given municipality, assigns address point spatial units (either H3 hexagonal cells user-provided polygons), computes residential proportion (p_res) land-use mix indices, Entropy Index (ei), Herfindahl-Hirschman Index (hhi), Balance Index (bal), Index Concentration Extremes (ice), adapted HHI (hhi_adp), Bidirectional Global-centered Index (bgbi), following methodology proposed Pedreira Jr. et al. (2025).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"","code":"compute_lumi(   code_muni,   year = 2022,   polygon_type = c(\"hex\", \"user\"),   polygon = NULL,   crs_output = NULL,   h3_resolution = 9,   verbose = TRUE,   backend = c(\"duckdb\", \"r\") )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"code_muni Integer. Seven-digit IBGE municipality code. year Integer. CNEFE data year. Currently 2022 supported. Defaults 2022. polygon_type Character. Type polygon aggregation: \"hex\" (default) uses H3 hexagonal grid; \"user\" uses polygons provided via polygon parameter. polygon sf::sf object polygon geometries. Required polygon_type = \"user\". warning issued reporting percentage CNEFE points covered polygon area. CNEFE points fall within polygon, error raised. crs_output CRS output object. used polygon_type = \"user\". Default NULL, uses original CRS polygon argument. Can EPSG code (e.g., 4326, 31983) CRS object accepted sf::st_transform(). h3_resolution Integer. H3 grid resolution (default: 9). used polygon_type = \"hex\". verbose Logical; TRUE, prints messages timing information. backend Character. \"duckdb\" (default) uses DuckDB + H3 extension reading directly cached ZIP. \"r\" computes H3 R using h3jsr.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"sf::sf object containing: polygon_type = \"hex\": id_hex: H3 cell identifier p_res, ei, hhi, bal, ice, hhi_adp, bgbi: land-use mix indicators geometry: hexagon geometry (CRS 4326) polygon_type = \"user\": Original columns polygon p_res, ei, hhi, bal, ice, hhi_adp, bgbi: land-use mix indicators geometry: polygon geometry (original crs_output CRS)","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"Pedreira Jr., J. U.; Louro, T. V.; Assis, L. B. M.; Brito, P. L. Measuring land use mix address-level census data (2025). engrXiv. https://engrxiv.org/preprint/view/5975 Booth, .; Crouter, . C. (Eds.). (2001). Take Village? Community Effects Children, Adolescents, Families. Psychology Press. Song, Y.; Merlin, L.; Rodriguez, D. (2013). Comparing measures urban land use mix. Computers, Environment Urban Systems, 42, 1–13. https://doi.org/10.1016/j.compenvurbsys.2013.08.001","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/compute_lumi.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute land-use mix indicators on a spatial grid — compute_lumi","text":"","code":"if (FALSE) { # \\dontrun{ # Compute land-use mix indices on H3 hexagons lumi <- compute_lumi(code_muni = 2929057)  # Compute land-use mix indices on user-provided polygons (neighborhoods of Lauro de Freitas-BA) # Using geobr to download neighborhood boundaries library(geobr) nei_ldf <- subset(   read_neighborhood(year = 2022),   code_muni == 2919207 ) lumi_poly <- compute_lumi(   code_muni = 2919207,   polygon_type = \"user\",   polygon = nei_ldf ) } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":null,"dir":"Reference","previous_headings":"","what":"Read CNEFE data for a given municipality — read_cnefe","title":"Read CNEFE data for a given municipality — read_cnefe","text":"Downloads reads CNEFE CSV file given IBGE municipality code, using official IBGE FTP structure. function relies internal index linking municipality codes corresponding ZIP URLs. Data returned either Arrow Table (default) sf object SIRGAS 2000 coordinates.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read CNEFE data for a given municipality — read_cnefe","text":"","code":"read_cnefe(   code_muni,   year = 2022,   verbose = TRUE,   cache = TRUE,   output = c(\"arrow\", \"sf\") )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read CNEFE data for a given municipality — read_cnefe","text":"code_muni Integer. Seven-digit IBGE municipality code. year Integer. CNEFE data year. Currently 2022 supported. Defaults 2022. verbose Logical; TRUE, print informative messages download, extraction, reading steps. cache Logical; TRUE, cache downloaded ZIP file user-level cache directory specific package. FALSE, temporary file used removed reading. output Character. Output format. \"arrow\" (default) returns arrow::Table, whereas \"sf\" returns sf point object coordinates built LONGITUDE / LATITUDE CRS 4674.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Read CNEFE data for a given municipality — read_cnefe","text":"output = \"arrow\", arrow::Table containing CNEFE records given municipality. output = \"sf\", sf object point geometry EPSG:4674 (SIRGAS 2000), using LONGITUDE LATITUDE columns.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Read CNEFE data for a given municipality — read_cnefe","text":"output = \"arrow\" (default), function perform spatial conversion simply returns Arrow table. output = \"sf\", function converts result sf point object using LONGITUDE LATITUDE columns, CRS EPSG:4674 (SIRGAS 2000), keeping columns final object (remove = FALSE).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"caching","dir":"Reference","previous_headings":"","what":"Caching","title":"Read CNEFE data for a given municipality — read_cnefe","text":"cache = TRUE (default), downloaded ZIP file stored user-level cache directory specific package, created via tools::R_user_dir() = \"cache\". avoids re-downloading municipality file across sessions. cache = FALSE, ZIP file stored temporary location removed function exits.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/read_cnefe.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Read CNEFE data for a given municipality — read_cnefe","text":"","code":"if (FALSE) { # \\dontrun{ # Read CNEFE data as an Arrow table cnefe <- read_cnefe(code_muni = 2929057)  # Read as an sf spatial object cnefe_sf <- read_cnefe(code_muni = 2929057, output = \"sf\") } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_h3.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","title":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","text":"tracts_to_h3() performs dasymetric interpolation following steps: census tract totals allocated CNEFE dwelling points inside tract; allocated values aggregated H3 grid user-defined resolution. function uses DuckDB spatial H3 extensions heavy work.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_h3.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","text":"","code":"tracts_to_h3(   code_muni,   year = 2022,   h3_resolution = 9,   vars = c(\"pop_ph\", \"pop_ch\"),   cache = TRUE,   verbose = TRUE )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_h3.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","text":"code_muni Integer. Seven-digit IBGE municipality code. year Integer. CNEFE data year. Currently 2022 supported. Defaults 2022. h3_resolution Integer. H3 resolution (0 15). Defaults 9. vars Character vector. Names tract-level variables interpolate. Supported variables: pop_ph: population private households (Domicílios particulares). pop_ch: population collective households (Domicílios coletivos). male: total male population. female: total female population. age_0_4, age_5_9, age_10_14, age_15_19, age_20_24, age_25_29, age_30_39, age_40_49, age_50_59, age_60_69, age_70m: population age group. race_branca, race_preta, race_amarela, race_parda, race_indigena: population race/color (cor ou raça). n_resp: number household heads (Pessoas responsáveis por domicílios). avg_inc_resp: average income household heads. reference table mapping variable names official IBGE census tract codes descriptions, see tracts_variables_ref. Allocation rules: pop_ph allocated private dwellings. pop_ch allocated collective dwellings. sum-like variables allocated private dwellings tract ; tract zero private dwellings collective dwellings, allocated collective. avg_inc_resp assigned (split) eligible dwelling point using eligibility rule. cache Logical. Whether use existing package cache assets CNEFE zips. verbose Logical. Whether print step messages timing.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_h3.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","text":"sf object (CRS 4326) H3 grid requested interpolated variables.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_h3.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert census tract aggregates to an H3 grid using CNEFE points — tracts_to_h3","text":"","code":"if (FALSE) { # \\dontrun{ # Interpolate population to H3 hexagons hex_pop <- tracts_to_h3(   code_muni = 2929057,   vars = c(\"pop_ph\", \"pop_ch\") ) } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_polygon.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","title":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","text":"tracts_to_polygon() performs dasymetric interpolation following steps: census tract totals allocated CNEFE dwelling points inside tract; allocated values aggregated user-provided polygons (neighborhoods, administrative divisions, custom areas, etc.). function uses DuckDB spatial extensions heavy work.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_polygon.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","text":"","code":"tracts_to_polygon(   code_muni,   polygon,   year = 2022,   vars = c(\"pop_ph\", \"pop_ch\"),   crs_output = NULL,   cache = TRUE,   verbose = TRUE )"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_polygon.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","text":"code_muni Integer. Seven-digit IBGE municipality code. polygon sf::sf object polygon geometries (POLYGON MULTIPOLYGON). function automatically align CRS issue warning reporting percentage polygon area falls outside municipality. year Integer. CNEFE data year. Currently 2022 supported. Defaults 2022. vars Character vector. Names tract-level variables interpolate. Supported variables: pop_ph: population private households (Domicílios particulares). pop_ch: population collective households (Domicílios coletivos). male: total male population. female: total female population. age_0_4, age_5_9, age_10_14, age_15_19, age_20_24, age_25_29, age_30_39, age_40_49, age_50_59, age_60_69, age_70m: population age group. race_branca, race_preta, race_amarela, race_parda, race_indigena: population race/color (cor ou raça). n_resp: number household heads (Pessoas responsáveis por domicílios). avg_inc_resp: average income household heads. reference table mapping variable names official IBGE census tract codes descriptions, see tracts_variables_ref. Allocation rules: pop_ph allocated private dwellings. pop_ch allocated collective dwellings. sum-like variables allocated private dwellings tract ; tract zero private dwellings collective dwellings, allocated collective. avg_inc_resp assigned (split) eligible dwelling point using eligibility rule. crs_output CRS output object. Default NULL, uses original CRS polygon argument. Can EPSG code (e.g., 4326, 31983) CRS object accepted sf::st_transform(). cache Logical. Whether use existing package cache assets CNEFE zips. verbose Logical. Whether print step messages timing.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_polygon.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","text":"sf object user-provided polygons requested interpolated variables. output CRS matches original polygon CRS (crs_output specified).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_to_polygon.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert census tract aggregates to user-provided polygons using CNEFE points — tracts_to_polygon","text":"","code":"if (FALSE) { # \\dontrun{ # Interpolate population to user-provided polygons (neighborhoods of Lauro de Freitas-BA) # Using geobr to download neighborhood boundaries library(geobr) nei_ldf <- subset(   read_neighborhood(year = 2022),   code_muni == 2919207 ) poly_pop <- tracts_to_polygon(   code_muni = 2919207,   polygon = nei_ldf,   vars = c(\"pop_ph\", \"pop_ch\") ) } # }"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_variables_ref.html","id":null,"dir":"Reference","previous_headings":"","what":"Reference table for tracts_to_* function variables — tracts_variables_ref","title":"Reference table for tracts_to_* function variables — tracts_variables_ref","text":"data frame maps variable names used tracts_to_h3() tracts_to_polygon() official IBGE census tract dataset codes descriptions.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_variables_ref.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Reference table for tracts_to_* function variables — tracts_variables_ref","text":"","code":"tracts_variables_ref"},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_variables_ref.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Reference table for tracts_to_* function variables — tracts_variables_ref","text":"data frame 22 rows 4 columns: var_cnefetools Variable name used cnefetools functions. code_var_ibge Official IBGE variable code census tract aggregates. desc_var_ibge Official IBGE variable description Portuguese. table_ibge Name IBGE census tract table variable found (Domicilios, Pessoas, ResponsavelRenda).","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_variables_ref.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Reference table for tracts_to_* function variables — tracts_variables_ref","text":"IBGE - Censo Demografico 2022, Agregados por Setores Censitarios.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/reference/tracts_variables_ref.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Reference table for tracts_to_* function variables — tracts_variables_ref","text":"","code":"# View the reference table tracts_variables_ref #>    var_cnefetools code_var_ibge #> 1          pop_ph        V00005 #> 2          pop_ch        V00007 #> 3            male        V01007 #> 4          female        V01008 #> 5         age_0_4        V01031 #> 6         age_5_9        V01032 #> 7       age_10_14        V01033 #> 8       age_15_19        V01034 #> 9       age_20_24        V01035 #> 10      age_25_29        V01036 #> 11      age_30_39        V01037 #> 12      age_40_49        V01038 #> 13      age_50_59        V01039 #> 14      age_60_69        V01040 #> 15        age_70m        V01041 #> 16    race_branca        V01317 #> 17     race_preta        V01318 #> 18     race_parda        V01320 #> 19   race_amarela        V01319 #> 20  race_indigena        V01321 #> 21         n_resp        V06001 #> 22   avg_inc_resp        V06004 #>                                                                                                                         desc_var_ibge #> 1                                                               Domicilios Particulares Permanentes Ocupados, Quantidade de moradores #> 2                                                                           Domicilios Coletivos Com Morador, Quantidade de moradores #> 3                                                                                                                      Sexo masculino #> 4                                                                                                                       Sexo feminino #> 5                                                                                                                          0 a 4 anos #> 6                                                                                                                          5 a 9 anos #> 7                                                                                                                        10 a 14 anos #> 8                                                                                                                        15 a 19 anos #> 9                                                                                                                        20 a 24 anos #> 10                                                                                                                       25 a 29 anos #> 11                                                                                                                       30 a 39 anos #> 12                                                                                                                       40 a 49 anos #> 13                                                                                                                       50 a 59 anos #> 14                                                                                                                       60 a 69 anos #> 15                                                                                                                    70 anos ou mais #> 16                                                                                                               Cor ou raca e branca #> 17                                                                                                                Cor ou raca e preta #> 18                                                                                                                Cor ou raca e parda #> 19                                                                                                              Cor ou raca e amarela #> 20                                                                                                             Cor ou raca e indigena #> 21                                                               Pessoas responsaveis em domicilios particulares permanentes ocupados #> 22 Valor do rendimento nominal medio mensal das pessoas responsaveis com rendimentos por domicilios particulares permanentes ocupados #>          table_ibge #> 1        Domicilios #> 2        Domicilios #> 3           Pessoas #> 4           Pessoas #> 5           Pessoas #> 6           Pessoas #> 7           Pessoas #> 8           Pessoas #> 9           Pessoas #> 10          Pessoas #> 11          Pessoas #> 12          Pessoas #> 13          Pessoas #> 14          Pessoas #> 15          Pessoas #> 16          Pessoas #> 17          Pessoas #> 18          Pessoas #> 19          Pessoas #> 20          Pessoas #> 21 ResponsavelRenda #> 22 ResponsavelRenda  # Find the IBGE code for a specific variable tracts_variables_ref[tracts_variables_ref$var_cnefetools == \"pop_ph\", ] #>   var_cnefetools code_var_ibge #> 1         pop_ph        V00005 #>                                                           desc_var_ibge #> 1 Domicilios Particulares Permanentes Ocupados, Quantidade de moradores #>   table_ibge #> 1 Domicilios"},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-011","dir":"Changelog","previous_headings":"","what":"cnefetools 0.1.1","title":"cnefetools 0.1.1","text":"Adds Balance Index (BAL), bal compute_lumi() function.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-010","dir":"Changelog","previous_headings":"","what":"cnefetools 0.1.0","title":"cnefetools 0.1.0","text":"New: tracts_to_h3() dasymetric interpolation tract aggregates CNEFE dwelling points H3 hexagons using DuckDB (spatial + h3). Added UF-level census tract Parquet assets (WKB geometry) hosted GitHub Releases downloaded -demand caching.","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-006","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.6","title":"cnefetools 0.0.6","text":"Moves DBI duckdb Imports DuckDB backend works box Removes silent fallback backend = \"r\" backend = \"duckdb\" requested changes outputs; behavior unchanged aside dependency handling","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-005","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.5","title":"cnefetools 0.0.5","text":"Makes unit tests reproducible CI-friendly removing dependencies network access local cache state (offline ZIP fixture mocked downloads) Improves robustness read_cnefe(output = \"sf\") handling missing coordinates converting sf Updates COD_ESPECIE documentation removes tidyselect deprecation warnings tests internals","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-004","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.4","title":"cnefetools 0.0.4","text":"Major speed-H3 assignment hex-level aggregation via DuckDB + H3 extension (SQL), runtimes dropping minutes seconds large municipalities Adds configurable backend backwards compatibility: backend = \"duckdb\" (default) backend = \"r\" hex_cnefe_counts() compute_lumi() Refactors internals reuse cached ZIPs consolidate common helpers, reducing repeated overhead improving maintainability","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-003","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.3","title":"cnefetools 0.0.3","text":"robust downloads retry logic increased timeout needed Avoids leaving partial corrupted ZIP files cache Automatically detects corrupted cached ZIPs re-downloads extraction","code":""},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-002","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.2","title":"cnefetools 0.0.2","text":"Add compute_lumi() compute land-use mix indicators (EI, HHI, adapted HHI, BGBI) H3 grids. Extend README examples Fortaleza (code 2304400) BGBI maps.","code":""},{"path":[]},{"path":"https://pedreirajr.github.io/cnefetools/dev/news/index.html","id":"cnefetools-0009000","dir":"Changelog","previous_headings":"","what":"cnefetools 0.0.0.9000","title":"cnefetools 0.0.0.9000","text":"Initial development version. Basic package infrastructure set .","code":""}]
