<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Intra-urban analysis with cnefe_counts() • cnefetools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Intra-urban analysis with cnefe_counts()">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cnefetools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cnefe_counts.html">Intra-urban analysis with cnefe_counts()</a></li>
    <li><a class="dropdown-item" href="../articles/compute_lumi.html">Comparing land use mix indices with compute_lumi()</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/read_cnefe.html">Exploring CNEFE address data</a></li>
    <li><a class="dropdown-item" href="../articles/tracts_to.html">Dasymetric interpolation with tracts_to_* functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pedreirajr/cnefetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Intra-urban analysis with cnefe_counts()</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pedreirajr/cnefetools/blob/main/vignettes/articles/cnefe_counts.Rmd" class="external-link"><code>vignettes/articles/cnefe_counts.Rmd</code></a></small>
      <div class="d-none name"><code>cnefe_counts.Rmd</code></div>
    </div>

    
    
<p>In February 2024, IBGE released CNEFE data from the 2022 Census
showing that Brazil has more religious temples (579,800) than
educational establishments (264,400) and health facilities (247,500)
combined. This finding sparked widespread media coverage and public
debate (see <a href="https://agenciabrasil.ebc.com.br/geral/noticia/2024-02/brasil-tem-mais-estabelecimentos-religiosos-que-escolas-e-hospitais" class="external-link">Agência
Brasil</a>).</p>
<p>However, these figures represent national or state-level aggregates.
What about the <strong>intra-urban</strong> distribution? Are there
neighborhoods with a particularly high concentration of religious
establishments relative to educational establishments?
<code><a href="../reference/cnefe_counts.html">cnefe_counts()</a></code> allows us to answer these questions by
aggregating CNEFE address counts to H3 hexagonal cells or user-provided
polygons such as neighborhoods.</p>
<p>In this article, we compute an Index of Concentration at the Extremes
(ICE) comparing educational and religious establishments for the
municipality of Porto Alegre, using both H3 resolution 8 hexagons and
official neighborhood boundaries.</p>
<p>Before computing ICE, let’s read the CNEFE data for Porto Alegre as
point geometries and visualize the spatial distribution of educational
and religious establishments:</p>
<div class="section level3">
<h3 id="attaching-libraries">Attaching libraries:<a class="anchor" aria-label="anchor" href="#attaching-libraries"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pedreirajr/cnefetools" class="external-link">cnefetools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/geobr/" class="external-link">geobr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reading-cnefe-data-to-visualize-educational-and-religious-establishments">Reading CNEFE data to visualize educational and religious
establishments:<a class="anchor" aria-label="anchor" href="#reading-cnefe-data-to-visualize-educational-and-religious-establishments"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poa_cnefe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_cnefe.html">read_cnefe</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">4314902</span>, <span class="co"># IBGE code for Porto Alegre)</span></span>
<span>  cache <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  output <span class="op">=</span> <span class="st">'sf'</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">poa_cnefe_edurel</span> <span class="op">&lt;-</span> <span class="va">poa_cnefe</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">COD_ESPECIE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Select only educational (4) and religious (8) facilities</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    est_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">COD_ESPECIE</span> <span class="op">==</span> <span class="fl">4</span>,<span class="st">'Educational'</span>,<span class="st">'Religious'</span><span class="op">)</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">poa_cnefe_edurel</span>, </span>
<span>  zcol <span class="op">=</span> <span class="st">'est_type'</span>, </span>
<span>  layer.name <span class="op">=</span> <span class="st">'Establishment type'</span>,</span>
<span>  col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>, <span class="co"># Blue (educational) and Red (religious)</span></span>
<span>  cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  burst <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span>   </span>
<span><span class="co">#&gt; Error in path.expand(path): argumento 'path' inválido</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-index-of-concentration-at-the-extremes-ice">The Index of Concentration at the Extremes (ICE)<a class="anchor" aria-label="anchor" href="#the-index-of-concentration-at-the-extremes-ice"></a>
</h2>
<p>ICE was originally proposed by Booth &amp; Crouter (2001) to measure
spatial concentration between two groups. We adapt it here to compare
educational (<code>addr_type4</code>) and religious
(<code>addr_type8</code>) establishments:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ICE</mtext><mo>=</mo><mfrac><mrow><msub><mi>n</mi><mtext mathvariant="normal">educational</mtext></msub><mo>−</mo><msub><mi>n</mi><mtext mathvariant="normal">religious</mtext></msub></mrow><mrow><msub><mi>n</mi><mtext mathvariant="normal">educational</mtext></msub><mo>+</mo><msub><mi>n</mi><mtext mathvariant="normal">religious</mtext></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\text{ICE} = \frac{n_{\text{educational}} - n_{\text{religious}}}{n_{\text{educational}} + n_{\text{religious}}}
</annotation></semantics></math></p>
<p>The index ranges from -1 to +1:</p>
<ul>
<li>
<strong>+1</strong>: all establishments are educational (maximum
concentration of educational establishments)</li>
<li>
<strong>0</strong>: equal number of educational and religious
establishments</li>
<li>
<strong>-1</strong>: all establishments are religious (maximum
concentration of temples)</li>
</ul>
</div>
<div class="section level2">
<h2 id="aggregating-counts-to-h3-hexagons">Aggregating counts to H3 hexagons<a class="anchor" aria-label="anchor" href="#aggregating-counts-to-h3-hexagons"></a>
</h2>
<p>We use <code><a href="../reference/cnefe_counts.html">cnefe_counts()</a></code> with
<code>polygon_type = "hex"</code> and <code>h3_resolution = 8</code> to
aggregate address counts to H3 hexagonal cells. Resolution 8 cells have
an average area of approximately 0.74 km².</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>poa_hex_counts <span class="ot">&lt;-</span> <span class="fu">cnefe_counts</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">code_muni =</span> <span class="dv">4314902</span>, <span class="co"># IBGE code for Porto Alegre</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">polygon_type =</span> <span class="st">"hex"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">h3_resolution =</span> <span class="dv">8</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>ℹ Step <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">:</span> ensuring ZIP and inspecting archive...</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                                                   </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>ℹ Using cached file<span class="sc">:</span> C<span class="sc">:</span>\Users\jorge\AppData\Local<span class="sc">/</span>R<span class="sc">/</span>cache<span class="sc">/</span>R<span class="sc">/</span>cnefetools<span class="sc">/</span><span class="dv">4314902</span>_PORTO_ALEGRE.zip</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; ℹ Step 1/3: ensuring ZIP and inspecting archive...</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>✔ Step <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> (ZIP ready) [<span class="dv">178</span>ms]                    </span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>ℹ Step <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span><span class="sc">:</span> building full H3 grid over municipality boundary...</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>✔ Step <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span> (H3 grid) [<span class="fl">3.2</span>s]                                    </span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>ℹ Step <span class="dv">3</span><span class="sc">/</span><span class="dv">3</span><span class="sc">:</span> counting address species per hexagon...</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>✔ Step <span class="dv">3</span><span class="sc">/</span><span class="dv">3</span> (count computation) [<span class="fl">1.9</span>s]              </span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="fu">head</span>(poa_hex_counts)</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 9 fields</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -51.1276 ymin: -30.24817 xmax: -51.08759 ymax: -30.22164</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt;            id_hex addr_type1 addr_type2 addr_type3 addr_type4 addr_type5</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; 1 88a9010c83fffff          0          0          0          0          0</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; 2 88a9010c87fffff        444          0          0          0          1</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; 3 88a9010c8bfffff          0          0          0          0          0</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; 4 88a9010c91fffff          5          0          0          0          0</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; 5 88a9010c93fffff         11          0          0          0          0</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt; 6 88a9010c95fffff         43          0          0          0          0</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt;   addr_type6 addr_type7 addr_type8                       geometry</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt; 1          0          0          0 POLYGON ((-51.10091 -30.241...</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt; 2         27          6          5 POLYGON ((-51.09175 -30.240...</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt; 3          0          0          0 POLYGON ((-51.10422 -30.248...</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt; 4          2          0          0 POLYGON ((-51.11591 -30.236...</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt; 5          1          0          0 POLYGON ((-51.12176 -30.230...</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt; 6          2          0          0 POLYGON ((-51.10675 -30.235...</span></span></code></pre></div>
<p>The output contains columns <code>addr_type1</code> through
<code>addr_type8</code>, corresponding to CNEFE address types. The ones
we are interested in are:</p>
<ul>
<li>
<code>addr_type4</code>: Educational establishments</li>
<li>
<code>addr_type8</code>: Religious establishments</li>
</ul>
</div>
<div class="section level2">
<h2 id="computing-ice-for-h3-hexagons">Computing ICE for H3 hexagons<a class="anchor" aria-label="anchor" href="#computing-ice-for-h3-hexagons"></a>
</h2>
<p>We compute ICE only for hexagons that have at least one educational
or religious establishment:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poa_hex_ice</span> <span class="op">&lt;-</span> <span class="va">poa_hex_counts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">addr_type4</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">addr_type8</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ice <span class="op">=</span> <span class="op">(</span><span class="va">addr_type4</span> <span class="op">-</span> <span class="va">addr_type8</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">addr_type4</span> <span class="op">+</span> <span class="va">addr_type8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">poa_hex_ice</span><span class="op">$</span><span class="va">ice</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#&gt; -1.00000 -1.00000 -0.38462 -0.27384  0.07692  1.00000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-h3-results">Mapping H3 results<a class="anchor" aria-label="anchor" href="#mapping-h3-results"></a>
</h2>
<p>We use a diverging color scale: blue indicates higher concentration
of educational establishments (+1), white indicates balance (0), and red
indicates higher concentration of religious establishments (-1).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">poa_hex_ice</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"ice"</span>,</span>
<span>  col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"ICE (H3 res. 8)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in path.expand(path): argumento 'path' inválido</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="aggregating-counts-to-neighborhoods">Aggregating counts to neighborhoods<a class="anchor" aria-label="anchor" href="#aggregating-counts-to-neighborhoods"></a>
</h2>
<p>Now we use official neighborhood boundaries from the <a href="https://github.com/ipeaGIT/geobr" class="external-link"><code>geobr</code> package</a>.
The <code><a href="../reference/cnefe_counts.html">cnefe_counts()</a></code> function accepts user-provided polygons
via the <code>polygon</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Porto Alegre neighborhoods</span></span>
<span><span class="va">poa_neighborhoods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ipeagit.github.io/geobr/reference/read_neighborhood.html" class="external-link">read_neighborhood</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2022</span>, simplified <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name_muni</span> <span class="op">==</span> <span class="st">"Porto Alegre"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">poa_neighborhoods</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 94</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>poa_neigh_counts <span class="ot">&lt;-</span> <span class="fu">cnefe_counts</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="at">code_muni =</span> <span class="dv">4314902</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">polygon_type =</span> <span class="st">"user"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="at">polygon =</span> poa_neighborhoods</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>ℹ Step <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span><span class="sc">:</span> ensuring ZIP and inspecting archive...</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>                                                   </span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>ℹ Using cached file<span class="sc">:</span> C<span class="sc">:</span>\Users\jorge\AppData\Local<span class="sc">/</span>R<span class="sc">/</span>cache<span class="sc">/</span>R<span class="sc">/</span>cnefetools<span class="sc">/</span><span class="dv">4314902</span>_PORTO_ALEGRE.zip</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; ℹ Step 1/4: ensuring ZIP and inspecting archive...</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>✔ Step <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> (ZIP ready) [<span class="dv">161</span>ms]                    </span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>ℹ Step <span class="dv">2</span><span class="sc">/</span><span class="dv">4</span><span class="sc">:</span> preparing polygon <span class="cf">for</span> spatial join...</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  Input CRS<span class="sc">:</span> EPSG<span class="sc">:</span><span class="dv">4674</span> <span class="sc">|</span> Output CRS<span class="sc">:</span> EPSG<span class="sc">:</span><span class="dv">4674</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>✔ Step <span class="dv">2</span><span class="sc">/</span><span class="dv">4</span> (CRS alignment) [<span class="dv">275</span>ms]               </span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>ℹ Step <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span><span class="sc">:</span> reading CNEFE points and performing spatial join...</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>✔ Step <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> (spatial join) [<span class="dv">42</span>s]                                </span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>ℹ Step <span class="dv">4</span><span class="sc">/</span><span class="dv">4</span><span class="sc">:</span> aggregating counts per polygon...</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt; Warning: Polygon coverage: "100.0%" of CNEFE points captured.</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; ℹ 762110 of 762239 points are within the provided polygon.</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt; ℹ 129 points fell outside the polygon and were not counted.</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>✔ Step <span class="dv">4</span><span class="sc">/</span><span class="dv">4</span> (aggregation) [<span class="dv">799</span>ms]             </span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="fu">head</span>(poa_neigh_counts)</span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 26 fields</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -51.30325 ymin: -30.17167 xmax: -51.10924 ymax: -29.9323</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  SIRGAS 2000</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt;   code_muni    name_muni name_neighborhood code_neighborhood code_subdistrict</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt; 1   4314902 Porto Alegre Aberta dos Morros        4314902080      43149020500</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; 2   4314902 Porto Alegre         Agronomia        4314902035      43149020500</span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt; 3   4314902 Porto Alegre          Anchieta        4314902055      43149020500</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt; 4   4314902 Porto Alegre       Arquipélago        4314902033      43149020500</span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt; 5   4314902 Porto Alegre       Auxiliadora        4314902045      43149020500</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; 6   4314902 Porto Alegre            Azenha        4314902008      43149020500</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt;   name_subdistrict code_district name_district code_urban_concentration</span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt; 1             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt; 2             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a><span class="co">#&gt; 3             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="co">#&gt; 4             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="co">#&gt; 5             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="co">#&gt; 6             &lt;NA&gt;     431490205  Porto Alegre                  4314902</span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co">#&gt;   name_urban_concentration code_immediate name_immediate code_intermediate</span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="co">#&gt; 1          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="co">#&gt; 2          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="co">#&gt; 3          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a><span class="co">#&gt; 4          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="co">#&gt; 5          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a><span class="co">#&gt; 6          Porto Alegre/RS         430001   Porto Alegre              4301</span></span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a><span class="co">#&gt;   name_intermediate code_state        name_state code_region name_region</span></span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a><span class="co">#&gt; 1      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-70"><a href="#cb7-70" tabindex="-1"></a><span class="co">#&gt; 2      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-71"><a href="#cb7-71" tabindex="-1"></a><span class="co">#&gt; 3      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-72"><a href="#cb7-72" tabindex="-1"></a><span class="co">#&gt; 4      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-73"><a href="#cb7-73" tabindex="-1"></a><span class="co">#&gt; 5      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-74"><a href="#cb7-74" tabindex="-1"></a><span class="co">#&gt; 6      Porto Alegre         43 Rio Grande do Sul           4         Sul</span></span>
<span id="cb7-75"><a href="#cb7-75" tabindex="-1"></a><span class="co">#&gt;   addr_type1 addr_type2 addr_type3 addr_type4 addr_type5 addr_type6 addr_type7</span></span>
<span id="cb7-76"><a href="#cb7-76" tabindex="-1"></a><span class="co">#&gt; 1       4249          1          1          8          2        235        147</span></span>
<span id="cb7-77"><a href="#cb7-77" tabindex="-1"></a><span class="co">#&gt; 2       1219          3          1         11          1        113         22</span></span>
<span id="cb7-78"><a href="#cb7-78" tabindex="-1"></a><span class="co">#&gt; 3        294          1          0          3          1        446         16</span></span>
<span id="cb7-79"><a href="#cb7-79" tabindex="-1"></a><span class="co">#&gt; 4       2851          1          1         12          2        286         62</span></span>
<span id="cb7-80"><a href="#cb7-80" tabindex="-1"></a><span class="co">#&gt; 5       5464          3          0          9         45        576         57</span></span>
<span id="cb7-81"><a href="#cb7-81" tabindex="-1"></a><span class="co">#&gt; 6       8150         10          0         17         31       1236         39</span></span>
<span id="cb7-82"><a href="#cb7-82" tabindex="-1"></a><span class="co">#&gt;   addr_type8                           geom</span></span>
<span id="cb7-83"><a href="#cb7-83" tabindex="-1"></a><span class="co">#&gt; 1         15 MULTIPOLYGON (((-51.20221 -...</span></span>
<span id="cb7-84"><a href="#cb7-84" tabindex="-1"></a><span class="co">#&gt; 2          5 MULTIPOLYGON (((-51.15367 -...</span></span>
<span id="cb7-85"><a href="#cb7-85" tabindex="-1"></a><span class="co">#&gt; 3          1 MULTIPOLYGON (((-51.15517 -...</span></span>
<span id="cb7-86"><a href="#cb7-86" tabindex="-1"></a><span class="co">#&gt; 4         28 MULTIPOLYGON (((-51.26181 -...</span></span>
<span id="cb7-87"><a href="#cb7-87" tabindex="-1"></a><span class="co">#&gt; 5          1 MULTIPOLYGON (((-51.1865 -3...</span></span>
<span id="cb7-88"><a href="#cb7-88" tabindex="-1"></a><span class="co">#&gt; 6          5 MULTIPOLYGON (((-51.21153 -...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-ice-by-neighborhood">Computing ICE by neighborhood<a class="anchor" aria-label="anchor" href="#computing-ice-by-neighborhood"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poa_neigh_ice</span> <span class="op">&lt;-</span> <span class="va">poa_neigh_counts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">addr_type4</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">addr_type8</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ice <span class="op">=</span> <span class="op">(</span><span class="va">addr_type4</span> <span class="op">-</span> <span class="va">addr_type8</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">addr_type4</span> <span class="op">+</span> <span class="va">addr_type8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">poa_neigh_ice</span><span class="op">$</span><span class="va">ice</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#&gt; -1.00000 -0.44444 -0.20000 -0.07657  0.40741  1.00000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-neighborhood-results">Mapping neighborhood results<a class="anchor" aria-label="anchor" href="#mapping-neighborhood-results"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">poa_neigh_ice</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"ice"</span>,</span>
<span>  col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"ICE (Neighborhoods)"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in path.expand(path): argumento 'path' inválido</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-spatial-resolutions">Comparing spatial resolutions<a class="anchor" aria-label="anchor" href="#comparing-spatial-resolutions"></a>
</h2>
<p>The H3 hexagonal grid offers several desirable topological properties
for spatial analysis: all cells have the same area and shape, every cell
has exactly six neighbors at equal distances, and the grid avoids the
orientation artifacts that arise with square grids. These properties
make hexagonal grids particularly well-suited for spatial statistics,
neighborhood-based indicators, and smooth interpolation across
space.</p>
<p>On the other hand, user-provided polygons, such as neighborhoods or
health districts, carry administrative or institutional meaning that is
directly relevant to policy-making and domain-specific research. By
supporting any polygon geometry, <code><a href="../reference/cnefe_counts.html">cnefe_counts()</a></code> allows
researchers and practitioners to aggregate CNEFE data to whichever
spatial unit best fits their study design.</p>
<p>Both approaches demonstrate how <code><a href="../reference/cnefe_counts.html">cnefe_counts()</a></code> enables
intra-urban analysis, moving beyond aggregate national statistics to
reveal spatial patterns within cities.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Booth, A.; Crouter, A. C. (Eds.). (2001). <em>Does It Take a Village?
Community Effects on Children, Adolescents, and Families</em>.
Psychology Press.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jorge Ubirajara Pedreira Junior.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
