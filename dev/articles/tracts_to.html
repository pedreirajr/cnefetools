<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dasymetric interpolation with tracts_to_* functions • cnefetools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dasymetric interpolation with tracts_to_* functions">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cnefetools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cnefe_counts.html">Intra-urban analysis with cnefe_counts()</a></li>
    <li><a class="dropdown-item" href="../articles/compute_lumi.html">Comparing land use mix indices with compute_lumi()</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/read_cnefe.html">Exploring CNEFE address data</a></li>
    <li><a class="dropdown-item" href="../articles/tracts_to.html">Dasymetric interpolation with tracts_to_* functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pedreirajr/cnefetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dasymetric interpolation with tracts_to_* functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pedreirajr/cnefetools/blob/main/vignettes/articles/tracts_to.Rmd" class="external-link"><code>vignettes/articles/tracts_to.Rmd</code></a></small>
      <div class="d-none name"><code>tracts_to.Rmd</code></div>
    </div>

    
    
<p>Census data in Brazil are published at the census tract level.
However, many research and planning applications require data at
different spatial granularities, such as hexagonal grids for
standardized spatial analysis, or custom polygons such as traffic zones
for transportation modeling.</p>
<p><code><a href="../reference/tracts_to_h3.html">tracts_to_h3()</a></code> and <code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code>
perform <strong>dasymetric interpolation</strong> using CNEFE dwelling
points as ancillary data. Instead of assuming uniform distribution
within tracts, they allocate tract-level values to individual dwelling
points identified in the CNEFE and then aggregate these to the target
spatial units. The allocation rule depends on the variable type:</p>
<ul>
<li>
<strong>Sum variables</strong> (e.g., <code>pop_ph</code>,
<code>race_preta</code>, <code>age_70m</code>): the tract total is
divided equally among eligible dwelling points. The target spatial unit
(e.g., hexagons, traffic zones, or any user-supplied polygon) receives
the sum of all point-level shares that fall within it.</li>
<li>
<strong>Average variables</strong> (<code>avg_inc_resp</code>): the
tract-level average is assigned (not split) to each eligible dwelling
point. The target spatial unit receives the average of all assigned
values within it.</li>
</ul>
<p>This approach preserves the heterogeneous distribution of dwellings
within each tract, yielding more accurate estimates than simple areal
interpolation.</p>
<p>This article demonstrates both functions: <code><a href="../reference/tracts_to_h3.html">tracts_to_h3()</a></code>
for transferring census variables to an H3 hexagonal grid in Fortaleza,
and <code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code> for transferring census variables
to traffic zones in São Paulo.</p>
<p>The currently supported variables (and their respective IBGE census
tract codes) can be found using the <code>tracts_variables_ref</code>
dataframe that accompanies the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pedreirajr/cnefetools" class="external-link">cnefetools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">tracts_variables_ref</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'tracts_variables_ref' não encontrado</span></span></code></pre></div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/leafsync" class="external-link">leafsync</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-1-census-variables-on-h3-hexagons-fortaleza">Part 1: Census variables on H3 hexagons (Fortaleza)<a class="anchor" aria-label="anchor" href="#part-1-census-variables-on-h3-hexagons-fortaleza"></a>
</h2>
<p>We interpolate three census variables to H3 resolution 8 hexagons for
Fortaleza (IBGE code 2304400):</p>
<ul>
<li>
<code>pop_ph</code>: population in private households</li>
<li>
<code>avg_inc_resp</code>: average income of household heads</li>
<li>
<code>race_preta</code>: population self-identified as Black
(<em>preta</em>)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftl_h3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tracts_to_h3.html">tracts_to_h3</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">2304400</span>,</span>
<span>  h3_resolution <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_ph"</span>, <span class="st">"avg_inc_resp"</span>, <span class="st">"race_preta"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `tracts_to_h3()`:</span></span>
<span><span class="co">#&gt; ! Unknown `vars`: pop_ph and race_preta. See `?tracts_to_h3` for</span></span>
<span><span class="co">#&gt;   available variables.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ftl_h3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3' não encontrado</span></span></code></pre></div>
<div class="section level3">
<h3 id="mapping-the-results">Mapping the results<a class="anchor" aria-label="anchor" href="#mapping-the-results"></a>
</h3>
<p>We use <code><a href="https://rdrr.io/pkg/leafsync/man/latticeView.html" class="external-link">leafsync::sync()</a></code> to display the three variables
side by side:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">ftl_h3</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"pop_ph"</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"Population"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3' não encontrado</span></span>
<span></span>
<span><span class="va">map_inc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">ftl_h3</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"avg_inc_resp"</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"Avg. income"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3' não encontrado</span></span>
<span></span>
<span><span class="va">map_race</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">ftl_h3</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"race_preta"</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"Black pop."</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3' não encontrado</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leafsync/man/latticeView.html" class="external-link">sync</a></span><span class="op">(</span><span class="va">map_pop</span>, <span class="va">map_inc</span>, <span class="va">map_race</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'map_pop' não encontrado</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exploring-the-relationship-between-income-and-racial-composition">Exploring the relationship between income and racial
composition<a class="anchor" aria-label="anchor" href="#exploring-the-relationship-between-income-and-racial-composition"></a>
</h3>
<p>We can examine the relationship between average household head income
and the proportion of Black population in each hexagon:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftl_h3_plot</span> <span class="op">&lt;-</span> <span class="va">ftl_h3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pop_ph</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pct_preta <span class="op">=</span> <span class="va">race_preta</span> <span class="op">/</span> <span class="va">pop_ph</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3' não encontrado</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ftl_h3_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_inc_resp</span>, y <span class="op">=</span> <span class="va">pct_preta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Average income of household heads (R$)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Black population share (race_preta / pop_ph)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'ftl_h3_plot' não encontrado</span></span></code></pre></div>
<p>As expected, the plot reveals a strong negative correlation between
these two variables: hexagons with a higher share of Black population
tend to have substantially lower average household income. This pattern
reflects deep-rooted racial income inequality, a persistent feature of
the Brazilian social landscape.</p>
</div>
</div>
<div class="section level2">
<h2 id="part-2-census-variables-on-traffic-zones-são-paulo">Part 2: Census variables on traffic zones (São Paulo)<a class="anchor" aria-label="anchor" href="#part-2-census-variables-on-traffic-zones-s%C3%A3o-paulo"></a>
</h2>
<p>Transportation planning often requires census-derived variables at
the traffic zone level rather than the census tract level. The <a href="https://github.com/hsvab/odbr/" class="external-link"><code>odbr</code> package</a>
provides traffic zone geometries from origin-destination surveys
conducted in Brazilian metropolitan areas. Since the OD survey for São
Paulo covers the entire metropolitan region (39 municipalities), we
filter only the traffic zones within the municipality of São Paulo.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hsvab.github.io/odbr/" class="external-link">odbr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load traffic zones for the São Paulo metropolitan region</span></span>
<span><span class="va">sp_zones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hsvab.github.io/odbr/reference/read_map.html" class="external-link">read_map</a></span><span class="op">(</span></span>
<span>  city <span class="op">=</span> <span class="st">"Sao Paulo"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2017</span>,</span>
<span>  geometry <span class="op">=</span> <span class="st">"zone"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter zones within the municipality of São Paulo</span></span>
<span><span class="va">sp_zones_muni</span> <span class="op">&lt;-</span> <span class="va">sp_zones</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NomeMunici</span> <span class="op">==</span> <span class="st">"São Paulo"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Correcting invalid geometries in advance</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sp_zones_muni</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 342</span></span></code></pre></div>
<p>We interpolate two variables:</p>
<ul>
<li>
<code>pop_ph</code>: population in private households</li>
<li>
<code>age_70m</code>: population aged 70 years or older</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_zones_census</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tracts_to_polygon.html">tracts_to_polygon</a></span><span class="op">(</span></span>
<span>  code_muni <span class="op">=</span> <span class="fl">3550308</span>,</span>
<span>  polygon <span class="op">=</span> <span class="va">sp_zones_muni</span>, </span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_ph"</span>, <span class="st">"age_70m"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `tracts_to_polygon()`:</span></span>
<span><span class="co">#&gt; ! Unknown `vars`: "pop_ph".</span></span>
<span><span class="co">#&gt; ℹ See `?tracts_to_polygon` for available variables.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sp_zones_census</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'sp_zones_census' não encontrado</span></span></code></pre></div>
<div class="section level3">
<h3 id="mapping-the-elderly-population-share">Mapping the elderly population share<a class="anchor" aria-label="anchor" href="#mapping-the-elderly-population-share"></a>
</h3>
<p>We compute the share of population aged 70+ in each traffic zone.
This indicator is relevant for identifying areas where transport
planning should prioritize accessibility for people with reduced
mobility, such as low-floor buses, accessible sidewalks, and
demand-responsive transit services.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_zones_ratio</span> <span class="op">&lt;-</span> <span class="va">sp_zones_census</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pop_ph</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pct_70m <span class="op">=</span> <span class="va">age_70m</span> <span class="op">/</span> <span class="va">pop_ph</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'sp_zones_census' não encontrado</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">sp_zones_ratio</span>,</span>
<span>  zcol <span class="op">=</span> <span class="st">"pct_70m"</span>,</span>
<span>  layer.name <span class="op">=</span> <span class="st">"Share of pop. aged 70+"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: objeto 'sp_zones_ratio' não encontrado</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<p>Notice how <code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code> is particularly useful in
transportation research, where census variables (such as population by
age group and income) are essential inputs for travel demand models
(especially in Trip Generation models from 4-Step modeling). However,
traffic zone geometries rarely align with census tract boundaries.
Dasymetric interpolation via CNEFE dwelling points provides a principled
method to bridge this spatial mismatch, transferring census data to
custom spatial units and supporting more accurate trip generation and
distribution models.</p>
<div class="section level3">
<h3 id="hint-to-scaling-to-multiple-municipalities">Hint to scaling to multiple municipalities<a class="anchor" aria-label="anchor" href="#hint-to-scaling-to-multiple-municipalities"></a>
</h3>
<p>The <code>odbr</code> traffic zones cover the entire São Paulo
metropolitan region (39 municipalities). To interpolate census data for
all municipalities, you can use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> to apply
<code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code> to each municipality and then combine
the results with <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="future-versions">Future versions<a class="anchor" aria-label="anchor" href="#future-versions"></a>
</h3>
<p>In future versions of the package, <code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code>
will support municipality-independent operation, allowing users to pass
polygons that span multiple municipalities without the need for
per-municipality iteration.</p>
</div>
<div class="section level3">
<h3 id="interpolation-diagnostics">Interpolation diagnostics<a class="anchor" aria-label="anchor" href="#interpolation-diagnostics"></a>
</h3>
<p>Both functions print detailed diagnostics after each run, so the user
can assess the quality of the interpolation. For example, the
<code><a href="../reference/tracts_to_h3.html">tracts_to_h3()</a></code> call for Fortaleza above produces:</p>
<pre><code>── Dasymetric interpolation diagnostics ──
! Unallocated total for population from private households (pop_ph): "2169" ("0.09%" of total)
! Unallocated total for race_preta (race_preta): "74" ("0.04%" of total)
! avg_inc_resp assigned to 1032500 of 1033953 eligible points
! avg_inc_resp is "NA" in 128 tracts
! Unmatched CNEFE points (no tract): 194
! Tracts with "NA" totals: pop_ph "NA" in 128; race_preta "NA" in 200
! Tracts with no eligible dwellings: pop_ph in 6 tracts; race_preta in 6 tracts</code></pre>
<p>And the <code><a href="../reference/tracts_to_polygon.html">tracts_to_polygon()</a></code> call for São Paulo:</p>
<pre><code>── Dasymetric interpolation diagnostics ──
! Unallocated total for population from private households (pop_ph): "86998" ("0.76%" of total)
! Unallocated total for age_70m (age_70m): "5397" ("0.58%" of total)
! Unmatched CNEFE points (no tract) = 2935
! Tracts with "NA" totals: pop_ph "NA" in 622; age_70m "NA" in 1316
! Tracts with no eligible dwellings: pop_ph in 324 tracts; age_70m in 297 tracts</code></pre>
<p>These warnings report the amount of unallocated population (and its
percentage of the census total), the number of CNEFE points that could
not be matched to a tract, and the number of tracts with missing values
or no eligible dwellings. In both examples, the unallocated shares are
small (below 1%), indicating that the interpolation preserves most of
the original census totals. Users should inspect these diagnostics to
decide whether the loss is acceptable for their application.</p>
</div>
<div class="section level3">
<h3 id="ecological-fallacy-caveat">Ecological fallacy caveat<a class="anchor" aria-label="anchor" href="#ecological-fallacy-caveat"></a>
</h3>
<p>Dasymetric interpolation distributes tract-level aggregates to
dwelling points under the assumption that each dwelling within a tract
receives an equal share of the total. This means that the method does
not recover true individual- or dwelling-level values; it redistributes
a group statistic. Drawing conclusions about individuals from such
aggregated data constitutes an <strong>ecological fallacy</strong> (the
error of attributing group-level patterns to individuals).</p>
<p>The risk is greater when the source census tracts are large, since
larger tracts are more likely to contain internally heterogeneous
populations, making the uniform allocation assumption less realistic.
Users should interpret interpolated values as spatial estimates of
aggregate quantities, not as precise measurements at the dwelling or
individual level.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jorge Ubirajara Pedreira Junior.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
