% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/read_cnefe.R
\name{read_cnefe}
\alias{read_cnefe}
\title{Read CNEFE 2022 data for a given municipality}
\usage{
read_cnefe(code_muni, verbose = TRUE, cache = TRUE)
}
\arguments{
\item{code_muni}{Integer. Seven-digit IBGE municipality code
municipality code.}

\item{verbose}{Logical; if \code{TRUE}, print informative messages about
download, extraction, and reading steps.}

\item{cache}{Logical; if \code{TRUE}, cache the downloaded ZIP file in a
user-level cache directory specific to this package. If \code{FALSE}, a
temporary file is used and removed after reading.}
}
\value{
An \link[arrow:Table-class]{arrow::Table} containing all CNEFE records for the given
municipality.
}
\description{
Downloads (optionally caching) and reads the CNEFE 2022 CSV file for a given
IBGE municipality code, using the official IBGE FTP structure. The function
relies on an internal index linking municipality codes to the corresponding
ZIP URLs. Data are returned as an Arrow \link[arrow:Table-class]{Table} for efficient
downstream processing.
}
\details{
Internally, \code{read_cnefe()}:
\enumerate{
\item Looks up the given \code{code_muni} in an internal index (\code{cnefe_index_2022}),
which maps municipality codes to ZIP URLs.
\item Downloads the corresponding ZIP file (or reuses a cached copy).
\item Finds the first \code{.csv} file inside the archive.
\item Extracts the CSV to a temporary directory.
\item Reads it with \code{\link[arrow:read_delim_arrow]{arrow::read_delim_arrow()}} assuming \code{";"} as delimiter.
}

The function does not attempt to interpret column types beyond Arrow's
defaults and does not perform any spatial conversion. These steps are left
to the user or to higher level helpers that may be added in future versions.
}
\section{Caching}{

When \code{cache = TRUE} (the default), the downloaded ZIP file is stored in a
user-level cache directory specific to this package, created via
\code{\link[tools:userdir]{tools::R_user_dir()}} with \code{which = "cache"}. This avoids re-downloading
the same municipality file across sessions.

When \code{cache = FALSE}, the ZIP file is stored in a temporary location and
removed when the function exits.
}

\examples{
\dontrun{
# Example: read CNEFE data for a municipality (Salvador)
tab <- read_cnefe(2927408)

# Convert to a data frame
df <- tab |> as.data.frame()
head(df)
}

}
