% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/read_cnefe.R
\name{read_cnefe}
\alias{read_cnefe}
\title{Read CNEFE 2022 data for a given municipality}
\usage{
read_cnefe(code_muni, verbose = TRUE, cache = TRUE, output = c("arrow", "sf"))
}
\arguments{
\item{code_muni}{Integer. Seven-digit IBGE municipality code.}

\item{verbose}{Logical; if \code{TRUE}, print informative messages about
download, extraction, and reading steps.}

\item{cache}{Logical; if \code{TRUE}, cache the downloaded ZIP file in a
user-level cache directory specific to this package. If \code{FALSE}, a
temporary file is used and removed after reading.}

\item{output}{Character. Output format. \code{"arrow"} (default) returns an
\link[arrow:Table-class]{arrow::Table}, whereas \code{"sf"} returns an \link[sf:st_as_sf]{sf} point object
with coordinates built from \code{LONGITUDE} / \code{LATITUDE} in CRS 4674.}
}
\value{
If \code{output = "arrow"}, an \link[arrow:Table-class]{arrow::Table} containing all CNEFE records for
the given municipality.

If \code{output = "sf"}, an \link[sf:st_as_sf]{sf} object with point geometry in
EPSG:4674 (SIRGAS 2000), using the \code{LONGITUDE} and \code{LATITUDE} columns.
}
\description{
Downloads and reads the CNEFE 2022 CSV file for a given
IBGE municipality code, using the official IBGE FTP structure. The function
relies on an internal index linking municipality codes to the corresponding
ZIP URLs. Data are returned either as an Arrow \link[arrow:Table-class]{Table}
(default) or as an \link[sf:st_as_sf]{sf} object with SIRGAS 2000 coordinates.
}
\details{
Internally, \code{read_cnefe()}:
\enumerate{
\item Looks up the given \code{code_muni} in an internal index,
which maps municipality codes to ZIP URLs.
\item Downloads the corresponding ZIP file (or reuses a cached copy).
\item Finds the first \code{.csv} file inside the archive.
\item Extracts the CSV to a temporary directory.
\item Reads it with \code{\link[arrow:read_delim_arrow]{arrow::read_delim_arrow()}} assuming \code{";"} as delimiter.
}

When \code{output = "arrow"} (default), the function does not perform any spatial
conversion and simply returns the Arrow table. When \code{output = "sf"}, the
function converts the result to an \link[sf:st_as_sf]{sf} point object using the
\code{LONGITUDE} and \code{LATITUDE} columns, with CRS EPSG:4674 (SIRGAS 2000),
keeping these columns in the final object (\code{remove = FALSE}).
}
\section{Caching}{

When \code{cache = TRUE} (the default), the downloaded ZIP file is stored in a
user-level cache directory specific to this package, created via
\code{\link[tools:userdir]{tools::R_user_dir()}} with \code{which = "cache"}. This avoids re-downloading
the same municipality file across sessions.

When \code{cache = FALSE}, the ZIP file is stored in a temporary location and
removed when the function exits.
}

